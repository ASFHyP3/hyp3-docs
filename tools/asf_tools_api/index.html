<!-- Extends https://github.com/squidfunk/mkdocs-material/blob/9.4.2/src/templates/base.html -->

<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="The Alaska Satellite Facility's Hybrid Pluggable Processing Pipeline">
      
      
        <meta name="author" content="ASF APD/Tools Team">
      
      
        <link rel="canonical" href="https://hyp3-docs.asf.alaska.edu/hyp3-docs/tools/asf_tools_api/">
      
      
        <link rel="prev" href="../asf_tools/">
      
      
        <link rel="next" href="../../how_it_works/">
      
      
      <link rel="icon" href="../../images/favicon.ico">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.4.2">
    
    
      
        <title>API Reference - HyP3</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.d451bc0e.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../../stylesheets/asf.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#asf_tools-v084-api-reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Adapted from https://github.com/squidfunk/mkdocs-material/blob/9.4.2/src/templates/partials/header.html -->

<!-- Determine classes -->


  


<!-- Header -->
<header class="md-header md-header--shadow" data-md-component="header">
  <nav
    class="md-header__inner md-grid"
    aria-label="Header"
  >

    
    <!-- Link to ASF -->
    <a
      href="https://asf.alaska.edu/"
      title="ASF"
      class="md-header__button md-logo"
      aria-label="ASF"
      data-md-component="logo"
    >
      <img src="../../images/ASFLogo-Blue2.png" alt="logo" />
    </a>
    

    <!-- Link to home -->
    <a
      href="../.."
      title="HyP3"
      class="md-header__button md-logo"
      aria-label="HyP3"
      data-md-component="logo"
    >
      
  <img src="../../images/HyP3-graphic-only.png" alt="logo">

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            HyP3
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API Reference
            
          </span>
        </div>
      </div>
    </div>

    <!-- Color palette toggle -->
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>

      <!-- Search interface -->
      <div class="expert-rec-search">
  <ci-search></ci-search>
</div>
    

    <!-- Repository information -->
    
      <div class="md-header__source">
        <a href="https://github.com/ASFHyP3" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    ASF HyP3
  </div>
</a>
      </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!-- Extends https://github.com/squidfunk/mkdocs-material/blob/9.4.2/src/templates/base.html -->



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
<!--  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="HyP3" class="md-nav__button md-logo" aria-label="HyP3" data-md-component="logo">
      
  <img src="../../images/HyP3-graphic-only.png" alt="logo">

    </a>
    HyP3
  </label> -->
  
    <div class="md-nav__source">
      <a href="https://github.com/ASFHyP3" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 480 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg>
  </div>
  <div class="md-source__repository">
    ASF HyP3
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../about/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    HyP3
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1" id="__nav_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1">
            <span class="md-nav__icon md-icon"></span>
            HyP3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../about/hyp3_basic/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    HyP3 Basic
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_1_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../about/hyp3_plus/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    HyP3+
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_1_2" id="__nav_1_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_1_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_1_2">
            <span class="md-nav__icon md-icon"></span>
            HyP3+
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../about/hyp3_plus_terms/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Terms of Service
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../using/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Using HyP3
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2" id="__nav_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Using HyP3
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../using/vertex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Vertex
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../using/sdk/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    SDK
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2_2">
            <span class="md-nav__icon md-icon"></span>
            SDK
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/hyp3-sdk/blob/main/docs/sdk_example.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Example Notebook
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../using/sdk_api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../using/api/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../using/authentication/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authentication
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../using/credits/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Credits
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../using/downloading/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Downloads
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../usage_guidelines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    How to Cite HyP3
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../products/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Products
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3" id="__nav_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Products
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/rtc_product_guide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    RTC
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            RTC
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/rtc_product_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://storymaps.arcgis.com/stories/2ead3222d2294d1fae1d11d3f98d7c35" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StoryMap
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/rtc_atbd/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Theoretical Basis
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/insar_product_guide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    InSAR
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            InSAR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/insar_product_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://storymaps.arcgis.com/stories/68a8a3253900411185ae9eb6bb5283d3" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StoryMap
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_3" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/burst_insar_product_guide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Burst InSAR
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            Burst InSAR
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/burst_insar_product_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Guide
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://storymaps.arcgis.com/stories/191bf1b6962c402086807390b3ce63b0" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StoryMap
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_4" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/gunw_product_guide/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ARIA S1 GUNW
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_3_4" id="__nav_3_4_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_4">
            <span class="md-nav__icon md-icon"></span>
            ARIA S1 GUNW
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/gunw_product_guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Product Guide
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://its-live.jpl.nasa.gov/" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AutoRIFT
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../sentinel1/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sentinel-1 Mission
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../guides/introduction_to_sar/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    SAR Basics
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_5" id="__nav_5_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_5">
            <span class="md-nav__icon md-icon"></span>
            SAR Basics
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../guides/introduction_to_sar/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introduction to SAR
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../dems/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Digital Elevation Models
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../water_masking/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Water Masking
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://asf.alaska.edu/information/sar-information/what-is-sar/#sar_faq" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SAR FAQ
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_6" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../tutorials/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    Tutorials
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_6" id="__nav_6_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_6_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_6">
            <span class="md-nav__icon md-icon"></span>
            Tutorials
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/hyp3-sdk/blob/main/docs/sdk_example.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Using HyP3 Python SDK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/hyp3-sdk/blob/main/docs/hyp3_authentication.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Authenticate HyP3 in the SDK
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/hyp3-sdk/blob/main/docs/search_other_user_jobs.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Search another user's jobs
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/hyp3-sdk/blob/main/docs/hyp3_job_name_change.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Update existing job name
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../tutorials/process-new-granules-for-search-parameters/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Process new granules for search parameters
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/hyp3-docs/blob/main/docs/tutorials/hyp3_insar_stack_for_ts_analysis.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    InSAR time series with MintPy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/hyp3-docs/blob/main/docs/tutorials/hyp3_isce2_burst_stack_for_ts_analysis.ipynb" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    InSAR burst time series with MintPy
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://asf-daac.maps.arcgis.com/home/index.html" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    StoryMap Tutorials
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7" checked>
        
          
          <label class="md-nav__link" for="__nav_7" id="__nav_7_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Other Tools
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_7_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7">
            <span class="md-nav__icon md-icon"></span>
            Other Tools
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../arcgis_toolbox/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ArcGIS Toolbox
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
    
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_7_2" checked>
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../asf_tools/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    ASF Tools for Python
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_7_2" id="__nav_7_2_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_7_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_7_2">
            <span class="md-nav__icon md-icon"></span>
            ASF Tools for Python
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#asf_tools.composite" class="md-nav__link">
    composite
  </a>
  
    <nav class="md-nav" aria-label="composite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.get_area_raster" class="md-nav__link">
    get_area_raster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.get_full_extent" class="md-nav__link">
    get_full_extent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.get_target_epsg_code" class="md-nav__link">
    get_target_epsg_code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.make_composite" class="md-nav__link">
    make_composite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.reproject_to_target" class="md-nav__link">
    reproject_to_target
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.dem" class="md-nav__link">
    dem
  </a>
  
    <nav class="md-nav" aria-label="dem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.dem.prepare_dem_vrt" class="md-nav__link">
    prepare_dem_vrt
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.hydrosar" class="md-nav__link">
    hydrosar
  </a>
  
    <nav class="md-nav" aria-label="hydrosar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.flood_map" class="md-nav__link">
    flood_map
  </a>
  
    <nav class="md-nav" aria-label="flood_map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.flood_map.logstat" class="md-nav__link">
    logstat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.flood_map.make_flood_map" class="md-nav__link">
    make_flood_map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand" class="md-nav__link">
    hand
  </a>
  
    <nav class="md-nav" aria-label="hand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.calculate_hand_for_basins" class="md-nav__link">
    calculate_hand_for_basins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.make_copernicus_hand" class="md-nav__link">
    make_copernicus_hand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.prepare_hand_vrt" class="md-nav__link">
    prepare_hand_vrt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.calculate" class="md-nav__link">
    calculate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.prepare" class="md-nav__link">
    prepare
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.threshold" class="md-nav__link">
    threshold
  </a>
  
    <nav class="md-nav" aria-label="threshold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.threshold.expectation_maximization_threshold" class="md-nav__link">
    expectation_maximization_threshold
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.water_map" class="md-nav__link">
    water_map
  </a>
  
    <nav class="md-nav" aria-label="water_map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.water_map.format_raster_data" class="md-nav__link">
    format_raster_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.water_map.make_water_map" class="md-nav__link">
    make_water_map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.raster" class="md-nav__link">
    raster
  </a>
  
    <nav class="md-nav" aria-label="raster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.convert_scale" class="md-nav__link">
    convert_scale
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.read_as_array" class="md-nav__link">
    read_as_array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.read_as_masked_array" class="md-nav__link">
    read_as_masked_array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.write_cog" class="md-nav__link">
    write_cog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.tile" class="md-nav__link">
    tile
  </a>
  
    <nav class="md-nav" aria-label="tile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.tile.tile_array" class="md-nav__link">
    tile_array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.tile.untile_array" class="md-nav__link">
    untile_array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.util" class="md-nav__link">
    util
  </a>
  
    <nav class="md-nav" aria-label="util">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.GDALConfigManager" class="md-nav__link">
    GDALConfigManager
  </a>
  
    <nav class="md-nav" aria-label="GDALConfigManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.GDALConfigManager.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.epsg_to_wkt" class="md-nav__link">
    epsg_to_wkt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.get_coordinates" class="md-nav__link">
    get_coordinates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.get_epsg_code" class="md-nav__link">
    get_epsg_code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.watermasking" class="md-nav__link">
    watermasking
  </a>
  
    <nav class="md-nav" aria-label="watermasking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles" class="md-nav__link">
    generate_osm_tiles
  </a>
  
    <nav class="md-nav" aria-label="generate_osm_tiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.extract_water" class="md-nav__link">
    extract_water
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.merge_interior_and_ocean" class="md-nav__link">
    merge_interior_and_ocean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.process_ocean_tiles" class="md-nav__link">
    process_ocean_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.process_pbf" class="md-nav__link">
    process_pbf
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles" class="md-nav__link">
    generate_worldcover_tiles
  </a>
  
    <nav class="md-nav" aria-label="generate_worldcover_tiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.build_dataset" class="md-nav__link">
    build_dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.create_missing_tiles" class="md-nav__link">
    create_missing_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.crop_tile" class="md-nav__link">
    crop_tile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.get_tiles" class="md-nav__link">
    get_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.lat_lon_to_filenames" class="md-nav__link">
    lat_lon_to_filenames
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.tile_preprocessing" class="md-nav__link">
    tile_preprocessing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.lat_lon_to_tile_string" class="md-nav__link">
    lat_lon_to_tile_string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.merge_tiles" class="md-nav__link">
    merge_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.remove_temp_files" class="md-nav__link">
    remove_temp_files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.setup_directories" class="md-nav__link">
    setup_directories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_8" >
        
          
          <label class="md-nav__link" for="__nav_8" id="__nav_8_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Developers
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_8_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_8">
            <span class="md-nav__icon md-icon"></span>
            Developers
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../how_it_works/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Architecture
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../plugins/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Plugins
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../contributing/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contributing
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="https://github.com/ASFHyP3/.github/blob/main/CODE_OF_CONDUCT.md" target="_blank" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Code of Conduct
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_9" >
        
          
          
          <div class="md-nav__link md-nav__container">
            <a href="../../whats_new/" class="md-nav__link ">
              
  
  <span class="md-ellipsis">
    What's New
  </span>
  

            </a>
            
              
              <label class="md-nav__link " for="__nav_9" id="__nav_9_label" tabindex="0">
                <span class="md-nav__icon md-icon"></span>
              </label>
            
          </div>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_9_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_9">
            <span class="md-nav__icon md-icon"></span>
            What's New
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
    <li class="md-nav__item">
      <a href="../../news/hyp3_plus_introduction/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Introducing HyP3+
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
    <li class="md-nav__item">
      <a href="../../contact/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Contact Us
  </span>
  

      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#asf_tools.composite" class="md-nav__link">
    composite
  </a>
  
    <nav class="md-nav" aria-label="composite">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.get_area_raster" class="md-nav__link">
    get_area_raster
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.get_full_extent" class="md-nav__link">
    get_full_extent
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.get_target_epsg_code" class="md-nav__link">
    get_target_epsg_code
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.make_composite" class="md-nav__link">
    make_composite
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.composite.reproject_to_target" class="md-nav__link">
    reproject_to_target
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.dem" class="md-nav__link">
    dem
  </a>
  
    <nav class="md-nav" aria-label="dem">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.dem.prepare_dem_vrt" class="md-nav__link">
    prepare_dem_vrt
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.hydrosar" class="md-nav__link">
    hydrosar
  </a>
  
    <nav class="md-nav" aria-label="hydrosar">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.flood_map" class="md-nav__link">
    flood_map
  </a>
  
    <nav class="md-nav" aria-label="flood_map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.flood_map.logstat" class="md-nav__link">
    logstat
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.flood_map.make_flood_map" class="md-nav__link">
    make_flood_map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand" class="md-nav__link">
    hand
  </a>
  
    <nav class="md-nav" aria-label="hand">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.calculate_hand_for_basins" class="md-nav__link">
    calculate_hand_for_basins
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.make_copernicus_hand" class="md-nav__link">
    make_copernicus_hand
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.prepare_hand_vrt" class="md-nav__link">
    prepare_hand_vrt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.calculate" class="md-nav__link">
    calculate
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.hand.prepare" class="md-nav__link">
    prepare
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.threshold" class="md-nav__link">
    threshold
  </a>
  
    <nav class="md-nav" aria-label="threshold">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.threshold.expectation_maximization_threshold" class="md-nav__link">
    expectation_maximization_threshold
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.water_map" class="md-nav__link">
    water_map
  </a>
  
    <nav class="md-nav" aria-label="water_map">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.water_map.format_raster_data" class="md-nav__link">
    format_raster_data
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.hydrosar.water_map.make_water_map" class="md-nav__link">
    make_water_map
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.raster" class="md-nav__link">
    raster
  </a>
  
    <nav class="md-nav" aria-label="raster">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.convert_scale" class="md-nav__link">
    convert_scale
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.read_as_array" class="md-nav__link">
    read_as_array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.read_as_masked_array" class="md-nav__link">
    read_as_masked_array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.raster.write_cog" class="md-nav__link">
    write_cog
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.tile" class="md-nav__link">
    tile
  </a>
  
    <nav class="md-nav" aria-label="tile">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.tile.tile_array" class="md-nav__link">
    tile_array
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.tile.untile_array" class="md-nav__link">
    untile_array
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.util" class="md-nav__link">
    util
  </a>
  
    <nav class="md-nav" aria-label="util">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.GDALConfigManager" class="md-nav__link">
    GDALConfigManager
  </a>
  
    <nav class="md-nav" aria-label="GDALConfigManager">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.GDALConfigManager.__init__" class="md-nav__link">
    __init__
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.epsg_to_wkt" class="md-nav__link">
    epsg_to_wkt
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.get_coordinates" class="md-nav__link">
    get_coordinates
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.util.get_epsg_code" class="md-nav__link">
    get_epsg_code
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#asf_tools.watermasking" class="md-nav__link">
    watermasking
  </a>
  
    <nav class="md-nav" aria-label="watermasking">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles" class="md-nav__link">
    generate_osm_tiles
  </a>
  
    <nav class="md-nav" aria-label="generate_osm_tiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.extract_water" class="md-nav__link">
    extract_water
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.merge_interior_and_ocean" class="md-nav__link">
    merge_interior_and_ocean
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.process_ocean_tiles" class="md-nav__link">
    process_ocean_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_osm_tiles.process_pbf" class="md-nav__link">
    process_pbf
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles" class="md-nav__link">
    generate_worldcover_tiles
  </a>
  
    <nav class="md-nav" aria-label="generate_worldcover_tiles">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.build_dataset" class="md-nav__link">
    build_dataset
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.create_missing_tiles" class="md-nav__link">
    create_missing_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.crop_tile" class="md-nav__link">
    crop_tile
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.get_tiles" class="md-nav__link">
    get_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.lat_lon_to_filenames" class="md-nav__link">
    lat_lon_to_filenames
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.generate_worldcover_tiles.tile_preprocessing" class="md-nav__link">
    tile_preprocessing
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils" class="md-nav__link">
    utils
  </a>
  
    <nav class="md-nav" aria-label="utils">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.lat_lon_to_tile_string" class="md-nav__link">
    lat_lon_to_tile_string
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.merge_tiles" class="md-nav__link">
    merge_tiles
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.remove_temp_files" class="md-nav__link">
    remove_temp_files
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#asf_tools.watermasking.utils.setup_directories" class="md-nav__link">
    setup_directories
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="asf_tools-v084-api-reference"><code>asf_tools</code> <em>v0.8.4</em> API Reference<a class="headerlink" href="#asf_tools-v084-api-reference" title="Permanent link">&para;</a></h1>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">

        <p>Tools developed by ASF for working with SAR data</p>









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h2 id="asf_tools.composite" class="doc doc-heading">
            <code>composite</code>


<a href="#asf_tools.composite" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

        <p>Create a local-resolution-weighted composite from Sentinel-1 RTC products.</p>
<p>Create a local-resolution-weighted composite from a set of Sentinel-1 RTC
products (D. Small, 2012). The local resolution, defined as the inverse of the
local contributing (scattering) area, is used to weight each RTC products'
contributions to the composite image on a pixel-by-pixel basis. The composite image
is created as a Cloud Optimized GeoTIFF (COG). Additionally, a COG specifying
the number of rasters contributing to each composite pixel is created.</p>


<details class="references" open>
  <summary>References</summary>
  <p>David Small, 2012: <a href="https://doi.org/10.1109/IGARSS.2012.6350465">https://doi.org/10.1109/IGARSS.2012.6350465</a></p>
</details>








  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="asf_tools.composite.get_area_raster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_area_raster</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span></code>

<a href="#asf_tools.composite.get_area_raster" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Determine the path of the area raster for a given backscatter raster based on naming conventions for HyP3 RTC
products</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raster</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path of the backscatter raster, e.g. S1A_IW_20181102T155531_DVP_RTC30_G_gpuned_5685_VV.tif</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>area_raster</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>path of the area raster, e.g. S1A_IW_20181102T155531_DVP_RTC30_G_gpuned_5685_area.tif</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/composite.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_area_raster</span><span class="p">(</span><span class="n">raster</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the path of the area raster for a given backscatter raster based on naming conventions for HyP3 RTC</span>
<span class="sd">    products</span>

<span class="sd">    Args:</span>
<span class="sd">        raster: path of the backscatter raster, e.g. S1A_IW_20181102T155531_DVP_RTC30_G_gpuned_5685_VV.tif</span>

<span class="sd">    Returns:</span>
<span class="sd">        area_raster: path of the area raster, e.g. S1A_IW_20181102T155531_DVP_RTC30_G_gpuned_5685_area.tif</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="s1">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">raster</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span><span class="s1">&#39;area.tif&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.composite.get_full_extent" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_full_extent</span><span class="p">(</span><span class="n">raster_info</span><span class="p">)</span></code>

<a href="#asf_tools.composite.get_full_extent" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Determine the corner coordinates and geotransform for the full extent of a set of rasters</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raster_info</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of gdal.Info results for the set of rasters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>upper_left</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The upper left corner of the extent as a tuple</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>upper_right</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lower right corner of the extent as a tuple</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>geotransform</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geotransform of the extent as a list</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/composite.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_full_extent</span><span class="p">(</span><span class="n">raster_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the corner coordinates and geotransform for the full extent of a set of rasters</span>

<span class="sd">    Args:</span>
<span class="sd">        raster_info: A dictionary of gdal.Info results for the set of rasters</span>

<span class="sd">    Returns:</span>
<span class="sd">        upper_left: The upper left corner of the extent as a tuple</span>
<span class="sd">        upper_right: The lower right corner of the extent as a tuple</span>
<span class="sd">        geotransform: The geotransform of the extent as a list</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">upper_left_corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;upperLeft&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">raster_info</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
    <span class="n">lower_right_corners</span> <span class="o">=</span> <span class="p">[</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;lowerRight&#39;</span><span class="p">]</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">raster_info</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>

    <span class="n">ulx</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">ul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">ul</span> <span class="ow">in</span> <span class="n">upper_left_corners</span><span class="p">])</span>
    <span class="n">uly</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">ul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">ul</span> <span class="ow">in</span> <span class="n">upper_left_corners</span><span class="p">])</span>
    <span class="n">lrx</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">lr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">lower_right_corners</span><span class="p">])</span>
    <span class="n">lry</span> <span class="o">=</span> <span class="nb">min</span><span class="p">([</span><span class="n">lr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">lr</span> <span class="ow">in</span> <span class="n">lower_right_corners</span><span class="p">])</span>

    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Full extent raster upper left: (</span><span class="si">{</span><span class="n">ulx</span><span class="p">,</span><span class="w"> </span><span class="n">uly</span><span class="si">}</span><span class="s1">); lower right: (</span><span class="si">{</span><span class="n">lrx</span><span class="p">,</span><span class="w"> </span><span class="n">lry</span><span class="si">}</span><span class="s1">)&#39;</span><span class="p">)</span>

    <span class="n">trans</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">raster_info</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
        <span class="c1"># Only need info from any one raster</span>
        <span class="n">trans</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;geoTransform&#39;</span><span class="p">]</span>
        <span class="k">break</span>

    <span class="n">trans</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ulx</span>
    <span class="n">trans</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">uly</span>

    <span class="k">return</span> <span class="p">(</span><span class="n">ulx</span><span class="p">,</span> <span class="n">uly</span><span class="p">),</span> <span class="p">(</span><span class="n">lrx</span><span class="p">,</span> <span class="n">lry</span><span class="p">),</span> <span class="n">trans</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.composite.get_target_epsg_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_target_epsg_code</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span></code>

<a href="#asf_tools.composite.get_target_epsg_code" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Determine the target UTM EPSG projection for the output composite</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>codes</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>List of UTM EPSG codes</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>target</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>UTM EPSG code</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/composite.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_target_epsg_code</span><span class="p">(</span><span class="n">codes</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">int</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Determine the target UTM EPSG projection for the output composite</span>

<span class="sd">    Args:</span>
<span class="sd">        codes: List of UTM EPSG codes</span>

<span class="sd">    Returns:</span>
<span class="sd">        target: UTM EPSG code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># use median east/west UTM zone of all files, regardless of hemisphere</span>
    <span class="c1"># UTM EPSG codes for each hemisphere will look like:</span>
    <span class="c1">#   North: 326XX</span>
    <span class="c1">#   South: 327XX</span>
    <span class="n">valid_codes</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">32601</span><span class="p">,</span> <span class="mi">32661</span><span class="p">))</span> <span class="o">+</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">32701</span><span class="p">,</span> <span class="mi">32761</span><span class="p">))</span>
    <span class="k">if</span> <span class="n">bad_codes</span> <span class="o">:=</span> <span class="nb">set</span><span class="p">(</span><span class="n">codes</span><span class="p">)</span> <span class="o">-</span> <span class="nb">set</span><span class="p">(</span><span class="n">valid_codes</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Non UTM EPSG code encountered: </span><span class="si">{</span><span class="n">bad_codes</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">hemispheres</span> <span class="o">=</span> <span class="p">[</span><span class="n">c</span> <span class="o">//</span> <span class="mi">100</span> <span class="o">*</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">]</span>
    <span class="c1"># if even modes, choose lowest (North)</span>
    <span class="n">target_hemisphere</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">multimode</span><span class="p">(</span><span class="n">hemispheres</span><span class="p">))</span>

    <span class="n">zones</span> <span class="o">=</span> <span class="nb">sorted</span><span class="p">([</span><span class="n">c</span> <span class="o">%</span> <span class="mi">100</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="n">codes</span><span class="p">])</span>
    <span class="c1"># if even length, choose fist of median two</span>
    <span class="n">target_zone</span> <span class="o">=</span> <span class="n">zones</span><span class="p">[(</span><span class="nb">len</span><span class="p">(</span><span class="n">zones</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span><span class="p">)</span> <span class="o">//</span> <span class="mi">2</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">target_hemisphere</span> <span class="o">+</span> <span class="n">target_zone</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.composite.make_composite" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_composite</span><span class="p">(</span><span class="n">out_name</span><span class="p">,</span> <span class="n">rasters</span><span class="p">,</span> <span class="n">resolution</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#asf_tools.composite.make_composite" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a local-resolution-weighted composite from Sentinel-1 RTC products</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_name</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The base name of the output GeoTIFFs</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>rasters</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="str">str</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of file paths of the images to composite</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resolution</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pixel size for the output GeoTIFFs</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>out_raster</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created composite backscatter GeoTIFF</p>
              </div>
            </td>
          </tr>
          <tr class="doc-section-item">
<td><code>out_counts_raster</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path to the created GeoTIFF with counts of scenes contributing to each pixel</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/composite.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_composite</span><span class="p">(</span><span class="n">out_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">rasters</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">resolution</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a local-resolution-weighted composite from Sentinel-1 RTC products</span>

<span class="sd">    Args:</span>
<span class="sd">        out_name: The base name of the output GeoTIFFs</span>
<span class="sd">        rasters: A list of file paths of the images to composite</span>
<span class="sd">        resolution: The pixel size for the output GeoTIFFs</span>

<span class="sd">    Returns:</span>
<span class="sd">        out_raster: Path to the created composite backscatter GeoTIFF</span>
<span class="sd">        out_counts_raster: Path to the created GeoTIFF with counts of scenes contributing to each pixel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">rasters</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Must specify at least one raster to composite&#39;</span><span class="p">)</span>

    <span class="n">raster_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">raster</span> <span class="ow">in</span> <span class="n">rasters</span><span class="p">:</span>
        <span class="n">raster_info</span><span class="p">[</span><span class="n">raster</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
        <span class="c1"># make sure gdal can read the area raster</span>
        <span class="n">gdal</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="n">get_area_raster</span><span class="p">(</span><span class="n">raster</span><span class="p">))</span>

    <span class="n">target_epsg_code</span> <span class="o">=</span> <span class="n">get_target_epsg_code</span><span class="p">([</span><span class="n">get_epsg_code</span><span class="p">(</span><span class="n">info</span><span class="p">)</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">raster_info</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Composite projection is EPSG:</span><span class="si">{</span><span class="n">target_epsg_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">resolution</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="nb">max</span><span class="p">([</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;geoTransform&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="k">for</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">raster_info</span><span class="o">.</span><span class="n">values</span><span class="p">()])</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Composite resolution is </span><span class="si">{</span><span class="n">resolution</span><span class="si">}</span><span class="s1"> meters&#39;</span><span class="p">)</span>

    <span class="c1"># resample rasters to maximum resolution &amp; common UTM zone</span>
    <span class="k">with</span> <span class="n">TemporaryDirectory</span><span class="p">(</span><span class="n">prefix</span><span class="o">=</span><span class="s1">&#39;reprojected_&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">temp_dir</span><span class="p">:</span>
        <span class="n">raster_info</span> <span class="o">=</span> <span class="n">reproject_to_target</span><span class="p">(</span>
            <span class="n">raster_info</span><span class="p">,</span>
            <span class="n">target_epsg_code</span><span class="o">=</span><span class="n">target_epsg_code</span><span class="p">,</span>
            <span class="n">target_resolution</span><span class="o">=</span><span class="n">resolution</span><span class="p">,</span>
            <span class="n">directory</span><span class="o">=</span><span class="n">temp_dir</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># Get extent of union of all images</span>
        <span class="n">full_ul</span><span class="p">,</span> <span class="n">full_lr</span><span class="p">,</span> <span class="n">full_trans</span> <span class="o">=</span> <span class="n">get_full_extent</span><span class="p">(</span><span class="n">raster_info</span><span class="p">)</span>

        <span class="n">nx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">full_ul</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">full_lr</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="n">resolution</span><span class="p">)</span>
        <span class="n">ny</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">full_ul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">full_lr</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">//</span> <span class="n">resolution</span><span class="p">)</span>

        <span class="n">outputs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">ny</span><span class="p">,</span> <span class="n">nx</span><span class="p">))</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">outputs</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">int8</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">raster</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">raster_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing raster </span><span class="si">{</span><span class="n">raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Raster upper left: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;cornerCoordinates&quot;</span><span class="p">][</span><span class="s2">&quot;upperLeft&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">; &#39;</span>
                <span class="sa">f</span><span class="s1">&#39;lower right: </span><span class="si">{</span><span class="n">info</span><span class="p">[</span><span class="s2">&quot;cornerCoordinates&quot;</span><span class="p">][</span><span class="s2">&quot;lowerRight&quot;</span><span class="p">]</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

            <span class="n">values</span> <span class="o">=</span> <span class="n">read_as_array</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>

            <span class="n">area_raster</span> <span class="o">=</span> <span class="n">get_area_raster</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
            <span class="n">areas</span> <span class="o">=</span> <span class="n">read_as_array</span><span class="p">(</span><span class="n">area_raster</span><span class="p">)</span>

            <span class="n">ulx</span><span class="p">,</span> <span class="n">uly</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;upperLeft&#39;</span><span class="p">]</span>
            <span class="n">y_index_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">full_ul</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">uly</span><span class="p">)</span> <span class="o">//</span> <span class="n">resolution</span><span class="p">)</span>
            <span class="n">y_index_end</span> <span class="o">=</span> <span class="n">y_index_start</span> <span class="o">+</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

            <span class="n">x_index_start</span> <span class="o">=</span> <span class="nb">int</span><span class="p">((</span><span class="n">ulx</span> <span class="o">-</span> <span class="n">full_ul</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">//</span> <span class="n">resolution</span><span class="p">)</span>
            <span class="n">x_index_end</span> <span class="o">=</span> <span class="n">x_index_start</span> <span class="o">+</span> <span class="n">values</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

            <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
                <span class="sa">f</span><span class="s1">&#39;Placing values in output grid at </span><span class="si">{</span><span class="n">y_index_start</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">y_index_end</span><span class="si">}</span><span class="s1"> and </span><span class="si">{</span><span class="n">x_index_start</span><span class="si">}</span><span class="s1">:</span><span class="si">{</span><span class="n">x_index_end</span><span class="si">}</span><span class="s1">&#39;</span>
            <span class="p">)</span>

            <span class="n">mask</span> <span class="o">=</span> <span class="n">values</span> <span class="o">==</span> <span class="mi">0</span>
            <span class="n">raster_weights</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="o">/</span> <span class="n">areas</span>
            <span class="n">raster_weights</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

            <span class="n">outputs</span><span class="p">[</span><span class="n">y_index_start</span><span class="p">:</span><span class="n">y_index_end</span><span class="p">,</span> <span class="n">x_index_start</span><span class="p">:</span><span class="n">x_index_end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">values</span> <span class="o">*</span> <span class="n">raster_weights</span>
            <span class="n">weights</span><span class="p">[</span><span class="n">y_index_start</span><span class="p">:</span><span class="n">y_index_end</span><span class="p">,</span> <span class="n">x_index_start</span><span class="p">:</span><span class="n">x_index_end</span><span class="p">]</span> <span class="o">+=</span> <span class="n">raster_weights</span>
            <span class="n">counts</span><span class="p">[</span><span class="n">y_index_start</span><span class="p">:</span><span class="n">y_index_end</span><span class="p">,</span> <span class="n">x_index_start</span><span class="p">:</span><span class="n">x_index_end</span><span class="p">]</span> <span class="o">+=</span> <span class="o">~</span><span class="n">mask</span>

    <span class="k">del</span> <span class="n">values</span><span class="p">,</span> <span class="n">areas</span><span class="p">,</span> <span class="n">mask</span><span class="p">,</span> <span class="n">raster_weights</span>

    <span class="c1"># Divide by the total weight applied</span>
    <span class="n">outputs</span> <span class="o">/=</span> <span class="n">weights</span>
    <span class="k">del</span> <span class="n">weights</span>

    <span class="n">out_raster</span> <span class="o">=</span> <span class="n">write_cog</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_name</span><span class="si">}</span><span class="s1">.tif&#39;</span><span class="p">,</span> <span class="n">outputs</span><span class="p">,</span> <span class="n">full_trans</span><span class="p">,</span> <span class="n">target_epsg_code</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">outputs</span>

    <span class="n">out_counts_raster</span> <span class="o">=</span> <span class="n">write_cog</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">out_name</span><span class="si">}</span><span class="s1">_counts.tif&#39;</span><span class="p">,</span>
        <span class="n">counts</span><span class="p">,</span>
        <span class="n">full_trans</span><span class="p">,</span>
        <span class="n">target_epsg_code</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Int16</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">del</span> <span class="n">counts</span>

    <span class="k">return</span> <span class="n">out_raster</span><span class="p">,</span> <span class="n">out_counts_raster</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.composite.reproject_to_target" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">reproject_to_target</span><span class="p">(</span><span class="n">raster_info</span><span class="p">,</span> <span class="n">target_epsg_code</span><span class="p">,</span> <span class="n">target_resolution</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span></code>

<a href="#asf_tools.composite.reproject_to_target" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reprojects a set of raster images to a common projection and resolution</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raster_info</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A dictionary of gdal.Info results for the set of rasters</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_epsg_code</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The integer EPSG code for the target projection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>target_resolution</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The target resolution</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>directory</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory in which to create the reprojected files</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>target_raster_info</code></td>            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>An updated dictionary of gdal.Info results for the reprojected files</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/composite.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">reproject_to_target</span><span class="p">(</span><span class="n">raster_info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">target_epsg_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">target_resolution</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">directory</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">dict</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reprojects a set of raster images to a common projection and resolution</span>

<span class="sd">    Args:</span>
<span class="sd">        raster_info: A dictionary of gdal.Info results for the set of rasters</span>
<span class="sd">        target_epsg_code: The integer EPSG code for the target projection</span>
<span class="sd">        target_resolution: The target resolution</span>
<span class="sd">        directory: The directory in which to create the reprojected files</span>

<span class="sd">    Returns:</span>
<span class="sd">        target_raster_info: An updated dictionary of gdal.Info results for the reprojected files</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">target_raster_info</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">for</span> <span class="n">raster</span><span class="p">,</span> <span class="n">info</span> <span class="ow">in</span> <span class="n">raster_info</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">epsg_code</span> <span class="o">=</span> <span class="n">get_epsg_code</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
        <span class="n">resolution</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;geoTransform&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">epsg_code</span> <span class="o">!=</span> <span class="n">target_epsg_code</span> <span class="ow">or</span> <span class="n">resolution</span> <span class="o">!=</span> <span class="n">target_resolution</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reprojecting </span><span class="si">{</span><span class="n">raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">reprojected_raster</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">raster</span><span class="p">))</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span>
                <span class="n">reprojected_raster</span><span class="p">,</span>
                <span class="n">raster</span><span class="p">,</span>
                <span class="n">dstSRS</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;EPSG:</span><span class="si">{</span><span class="n">target_epsg_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">xRes</span><span class="o">=</span><span class="n">target_resolution</span><span class="p">,</span>
                <span class="n">yRes</span><span class="o">=</span><span class="n">target_resolution</span><span class="p">,</span>
                <span class="n">targetAlignedPixels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">area_raster</span> <span class="o">=</span> <span class="n">get_area_raster</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reprojecting </span><span class="si">{</span><span class="n">area_raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">reprojected_area_raster</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">directory</span><span class="p">,</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">area_raster</span><span class="p">))</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span>
                <span class="n">reprojected_area_raster</span><span class="p">,</span>
                <span class="n">area_raster</span><span class="p">,</span>
                <span class="n">dstSRS</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;EPSG:</span><span class="si">{</span><span class="n">target_epsg_code</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
                <span class="n">xRes</span><span class="o">=</span><span class="n">target_resolution</span><span class="p">,</span>
                <span class="n">yRes</span><span class="o">=</span><span class="n">target_resolution</span><span class="p">,</span>
                <span class="n">targetAlignedPixels</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="p">)</span>

            <span class="n">target_raster_info</span><span class="p">[</span><span class="n">reprojected_raster</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="n">reprojected_raster</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;No need to reproject </span><span class="si">{</span><span class="n">raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">target_raster_info</span><span class="p">[</span><span class="n">raster</span><span class="p">]</span> <span class="o">=</span> <span class="n">info</span>

    <span class="k">return</span> <span class="n">target_raster_info</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="asf_tools.dem" class="doc doc-heading">
            <code>dem</code>


<a href="#asf_tools.dem" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">

        <p>Prepare a Copernicus GLO-30 DEM virtual raster (VRT) covering a given geometry</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="asf_tools.dem.prepare_dem_vrt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_dem_vrt</span><span class="p">(</span><span class="n">vrt</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span></code>

<a href="#asf_tools.dem.prepare_dem_vrt" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Create a DEM mosaic VRT covering a given geometry</p>
<p>The DEM mosaic is assembled from the Copernicus GLO-30 DEM tiles that intersect the geometry.</p>
<p>Note: <code>asf_tools</code> does not currently support geometries that cross the antimeridian.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vrt</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path for the output VRT file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code><span title="osgeo.ogr.Geometry">Geometry</span> | <span title="shapely.geometry.base.BaseGeometry">BaseGeometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometry in EPSG:4326 (lon/lat) projection for which to prepare a DEM mosaic</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/dem.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_dem_vrt</span><span class="p">(</span><span class="n">vrt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">geometry</span><span class="p">:</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span> <span class="o">|</span> <span class="n">BaseGeometry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a DEM mosaic VRT covering a given geometry</span>

<span class="sd">    The DEM mosaic is assembled from the Copernicus GLO-30 DEM tiles that intersect the geometry.</span>

<span class="sd">    Note: `asf_tools` does not currently support geometries that cross the antimeridian.</span>

<span class="sd">    Args:</span>
<span class="sd">        vrt: Path for the output VRT file</span>
<span class="sd">        geometry: Geometry in EPSG:4326 (lon/lat) projection for which to prepare a DEM mosaic</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">GDALConfigManager</span><span class="p">(</span><span class="n">GDAL_DISABLE_READDIR_ON_OPEN</span><span class="o">=</span><span class="s1">&#39;EMPTY_DIR&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">BaseGeometry</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkb</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">wkb</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">)</span>
        <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">min_lon</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">160.0</span> <span class="ow">and</span> <span class="n">max_lon</span> <span class="o">&gt;</span> <span class="mf">160.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;asf_tools does not currently support geometries that cross the antimeridian: </span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">tile_features</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">DEM_GEOJSON</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vector</span><span class="o">.</span><span class="n">get_property_values_for_intersecting_features</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">tile_features</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copernicus GLO-30 DEM does not intersect this geometry: </span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">dem_file_paths</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">intersecting_feature_properties</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">tile_features</span><span class="p">,</span> <span class="s1">&#39;file_path&#39;</span><span class="p">)</span>

        <span class="n">gdal</span><span class="o">.</span><span class="n">BuildVRT</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrt</span><span class="p">),</span> <span class="n">dem_file_paths</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="asf_tools.hydrosar" class="doc doc-heading">
            <code>hydrosar</code>


<a href="#asf_tools.hydrosar" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="asf_tools.hydrosar.flood_map" class="doc doc-heading">
            <code>flood_map</code>


<a href="#asf_tools.hydrosar.flood_map" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

        <p>Generate flood depth map from surface water extent map.</p>
<p>Create a flood depth map from a surface water extent map and
a HAND image. The HAND image must be pixel-aligned (same extent and size) to
the water extent map, and the surface water extent map should be a byte GeoTIFF
indicating water (true), not water (false). Flood depth maps are estimated
using either a numerical, normalized median absolute deviation, logarithmic
or iterative approach.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.flood_map.logstat" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">logstat</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">func</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.flood_map.logstat" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Calculate a function in logarithmic scale and return in linear scale.
INF values inside the data array are set to nan.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>func</code>
            </td>
            <td>
                  <code><span title="collections.abc.Callable">Callable</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>statistical function to calculate in logarithmic scale</p>
              </div>
            </td>
            <td>
                  <code><span title="numpy.nanstd">nanstd</span></code>
            </td>
          </tr>
      </tbody>
    </table>
        <p>Returns:
    statistic: statistic of data in linear scale</p>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/flood_map.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">logstat</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">func</span><span class="p">:</span> <span class="n">Callable</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanstd</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate a function in logarithmic scale and return in linear scale.</span>
<span class="sd">    INF values inside the data array are set to nan.</span>

<span class="sd">    Args:</span>
<span class="sd">        data: array of data</span>
<span class="sd">        func: statistical function to calculate in logarithmic scale</span>
<span class="sd">    Returns:</span>
<span class="sd">        statistic: statistic of data in linear scale</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">ld</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">ld</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">isinf</span><span class="p">(</span><span class="n">ld</span><span class="p">)]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">st</span> <span class="o">=</span> <span class="n">func</span><span class="p">(</span><span class="n">ld</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">st</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.flood_map.make_flood_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_flood_map</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">vv_raster</span><span class="p">,</span> <span class="n">water_raster</span><span class="p">,</span> <span class="n">hand_raster</span><span class="p">,</span> <span class="n">estimator</span><span class="o">=</span><span class="s1">&#39;iterative&#39;</span><span class="p">,</span> <span class="n">water_level_sigma</span><span class="o">=</span><span class="mf">3.0</span><span class="p">,</span> <span class="n">known_water_threshold</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">iterative_bounds</span><span class="o">=</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span> <span class="n">iterative_min_size</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">minimization_metric</span><span class="o">=</span><span class="s1">&#39;ts&#39;</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.flood_map.make_flood_map" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Create a flood depth map from a surface water extent map.</p>
<p>WARNING: This functionality is still under active development and the products
created using this function are likely to change in the future.</p>
<p>Create a flood depth map from a single surface water extent map and
a HAND image. The HAND image must be pixel-aligned to the surface water extent map.
The surface water extent map should be a byte GeoTIFF indicating water (true) and
not water (false)</p>
<p>Known perennial Global Surface-water data are produced under the Copernicus Programme (Pekel et al., 2016),
and are included with surface-water detection maps when generating the flood depth product.</p>
<p>Flood depth maps are estimated using one of the approaches:
<em>Iterative: (Default) Basin hopping optimization method matches flooded areas to flood depth
estimates given by the HAND layer. This is the most accurate method but also the
most time-intensive.
</em>Normalized Median Absolute Deviation (nmad): Uses a median operator to estimate
the variation to increase robustness in the presence of outliers.
<em>Logstat: Calculates the mean and standard deviation of HAND heights in the logarithmic
domain to improve robustness for very non-Gaussian data distributions.
</em>Numpy: Calculates statistics on a linear scale. Least robust to outliers and non-Gaussian
distributions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Flood depth GeoTIFF to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vv_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sentinel-1 RTC GeoTIFF, in power scale, with VV polarization</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>water_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Surface water extent GeoTIFF</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hand_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height Above Nearest Drainage (HAND) GeoTIFF aligned to the surface water extent raster</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>estimator</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Estimation approach for determining flood depth</p>
              </div>
            </td>
            <td>
                  <code>&#39;iterative&#39;</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>water_level_sigma</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Max water height used in logstat, nmad, and numpy estimations</p>
              </div>
            </td>
            <td>
                  <code>3.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>known_water_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Threshold for extracting the known water area in percent.
If <code>None</code>, the threshold is calculated.</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>iterative_bounds</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum and maximum bound on the flood depths calculated by the basin-hopping algorithm
used in the iterative estimator</p>
              </div>
            </td>
            <td>
                  <code>(0, 15)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>iterative_min_size</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Minimum size of a connected waterbody in pixels for calculating flood depths with the
iterative estimator. Waterbodies smaller than this wll be skipped.</p>
              </div>
            </td>
            <td>
                  <code>0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>minimization_metric</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Evaluation method to minimize when using the iterative estimator.
Options include a Fowlkes-Mallows index (fmi) or a threat score (ts).</p>
              </div>
            </td>
            <td>
                  <code>&#39;ts&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


<details class="references" open>
  <summary>References</summary>
  <p>Jean-Francios Pekel, Andrew Cottam, Noel Gorelik, Alan S. Belward. 2016. <a href="https://doi:10.1038/nature20584">https://doi:10.1038/nature20584</a></p>
</details>

            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/flood_map.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_flood_map</span><span class="p">(</span>
    <span class="n">out_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">vv_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">water_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">hand_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">estimator</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;iterative&#39;</span><span class="p">,</span>
    <span class="n">water_level_sigma</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">3.0</span><span class="p">,</span>
    <span class="n">known_water_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">iterative_bounds</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">15</span><span class="p">),</span>
    <span class="n">iterative_min_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>
    <span class="n">minimization_metric</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;ts&#39;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a flood depth map from a surface water extent map.</span>

<span class="sd">    WARNING: This functionality is still under active development and the products</span>
<span class="sd">    created using this function are likely to change in the future.</span>

<span class="sd">    Create a flood depth map from a single surface water extent map and</span>
<span class="sd">    a HAND image. The HAND image must be pixel-aligned to the surface water extent map.</span>
<span class="sd">    The surface water extent map should be a byte GeoTIFF indicating water (true) and</span>
<span class="sd">    not water (false)</span>

<span class="sd">    Known perennial Global Surface-water data are produced under the Copernicus Programme (Pekel et al., 2016),</span>
<span class="sd">    and are included with surface-water detection maps when generating the flood depth product.</span>

<span class="sd">    Flood depth maps are estimated using one of the approaches:</span>
<span class="sd">    *Iterative: (Default) Basin hopping optimization method matches flooded areas to flood depth</span>
<span class="sd">    estimates given by the HAND layer. This is the most accurate method but also the</span>
<span class="sd">    most time-intensive.</span>
<span class="sd">    *Normalized Median Absolute Deviation (nmad): Uses a median operator to estimate</span>
<span class="sd">    the variation to increase robustness in the presence of outliers.</span>
<span class="sd">    *Logstat: Calculates the mean and standard deviation of HAND heights in the logarithmic</span>
<span class="sd">    domain to improve robustness for very non-Gaussian data distributions.</span>
<span class="sd">    *Numpy: Calculates statistics on a linear scale. Least robust to outliers and non-Gaussian</span>
<span class="sd">    distributions.</span>

<span class="sd">    Args:</span>
<span class="sd">        out_raster: Flood depth GeoTIFF to create</span>
<span class="sd">        vv_raster: Sentinel-1 RTC GeoTIFF, in power scale, with VV polarization</span>
<span class="sd">        water_raster: Surface water extent GeoTIFF</span>
<span class="sd">        hand_raster: Height Above Nearest Drainage (HAND) GeoTIFF aligned to the surface water extent raster</span>
<span class="sd">        estimator: Estimation approach for determining flood depth</span>
<span class="sd">        water_level_sigma: Max water height used in logstat, nmad, and numpy estimations</span>
<span class="sd">        known_water_threshold: Threshold for extracting the known water area in percent.</span>
<span class="sd">            If `None`, the threshold is calculated.</span>
<span class="sd">        iterative_bounds: Minimum and maximum bound on the flood depths calculated by the basin-hopping algorithm</span>
<span class="sd">            used in the iterative estimator</span>
<span class="sd">        iterative_min_size: Minimum size of a connected waterbody in pixels for calculating flood depths with the</span>
<span class="sd">            iterative estimator. Waterbodies smaller than this wll be skipped.</span>
<span class="sd">        minimization_metric: Evaluation method to minimize when using the iterative estimator.</span>
<span class="sd">            Options include a Fowlkes-Mallows index (fmi) or a threat score (ts).</span>

<span class="sd">    References:</span>
<span class="sd">        Jean-Francios Pekel, Andrew Cottam, Noel Gorelik, Alan S. Belward. 2016. &lt;https://doi:10.1038/nature20584&gt;</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">water_raster</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>
    <span class="n">epsg</span> <span class="o">=</span> <span class="n">get_epsg_code</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>
    <span class="n">geotransform</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;geoTransform&#39;</span><span class="p">]</span>
    <span class="n">hand_array</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">hand_raster</span><span class="p">),</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GA_ReadOnly</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fetching perennial flood data.&#39;</span><span class="p">)</span>
    <span class="n">known_water_mask</span> <span class="o">=</span> <span class="n">get_waterbody</span><span class="p">(</span><span class="n">info</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="n">known_water_threshold</span><span class="p">)</span>
    <span class="n">write_cog</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">out_raster</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">estimator</span><span class="si">}</span><span class="s1">_PW.tif&#39;</span><span class="p">),</span>
        <span class="n">known_water_mask</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">geotransform</span><span class="p">,</span>
        <span class="n">epsg_code</span><span class="o">=</span><span class="n">epsg</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
        <span class="n">nodata_value</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">water_map</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">water_raster</span><span class="p">))</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
    <span class="n">flood_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="n">water_map</span><span class="p">,</span> <span class="n">known_water_mask</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">water_map</span>

    <span class="n">vv_array</span> <span class="o">=</span> <span class="n">read_as_masked_array</span><span class="p">(</span><span class="n">vv_raster</span><span class="p">)</span>
    <span class="n">flood_mask</span><span class="p">[</span><span class="n">vv_array</span><span class="o">.</span><span class="n">mask</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">padding_mask</span> <span class="o">=</span> <span class="n">vv_array</span><span class="o">.</span><span class="n">mask</span>
    <span class="k">del</span> <span class="n">vv_array</span>

    <span class="c1"># The return type annotation for ndimage.label is int, which seems incorrect,</span>
    <span class="c1"># since the documentation shows an example of unpacking the return value, like we do here.</span>
    <span class="n">labeled_flood_mask</span><span class="p">,</span> <span class="n">num_labels</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">flood_mask</span><span class="p">)</span>  <span class="c1"># type: ignore[misc]</span>
    <span class="n">object_slices</span> <span class="o">=</span> <span class="n">ndimage</span><span class="o">.</span><span class="n">find_objects</span><span class="p">(</span><span class="n">labeled_flood_mask</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Detected </span><span class="si">{</span><span class="n">num_labels</span><span class="si">}</span><span class="s1"> waterbodies...&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">estimator</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;iterative&#39;</span><span class="p">:</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Skipping waterbodies less than </span><span class="si">{</span><span class="n">iterative_min_size</span><span class="si">}</span><span class="s1"> pixels.&#39;</span><span class="p">)</span>

    <span class="n">flood_depth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">flood_mask</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">ll</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_labels</span><span class="p">)):</span>  <span class="c1"># Skip first, largest label.</span>
        <span class="n">slices</span> <span class="o">=</span> <span class="n">object_slices</span><span class="p">[</span><span class="n">ll</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span>
        <span class="n">min0</span><span class="p">,</span> <span class="n">max0</span> <span class="o">=</span> <span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">slices</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span>
        <span class="n">min1</span><span class="p">,</span> <span class="n">max1</span> <span class="o">=</span> <span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">start</span><span class="p">,</span> <span class="n">slices</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">stop</span>

        <span class="n">flood_window</span> <span class="o">=</span> <span class="n">labeled_flood_mask</span><span class="p">[</span><span class="n">min0</span><span class="p">:</span><span class="n">max0</span><span class="p">,</span> <span class="n">min1</span><span class="p">:</span><span class="n">max1</span><span class="p">]</span>
        <span class="n">hand_window</span> <span class="o">=</span> <span class="n">hand_array</span><span class="p">[</span><span class="n">min0</span><span class="p">:</span><span class="n">max0</span><span class="p">,</span> <span class="n">min1</span><span class="p">:</span><span class="n">max1</span><span class="p">]</span>

        <span class="n">water_height</span> <span class="o">=</span> <span class="n">estimate_flood_depth</span><span class="p">(</span>
            <span class="n">ll</span><span class="p">,</span>
            <span class="n">hand_window</span><span class="p">,</span>
            <span class="n">flood_window</span><span class="p">,</span>
            <span class="n">estimator</span><span class="o">=</span><span class="n">estimator</span><span class="p">,</span>
            <span class="n">water_level_sigma</span><span class="o">=</span><span class="n">water_level_sigma</span><span class="p">,</span>
            <span class="n">iterative_bounds</span><span class="o">=</span><span class="n">iterative_bounds</span><span class="p">,</span>
            <span class="n">minimization_metric</span><span class="o">=</span><span class="n">minimization_metric</span><span class="p">,</span>
            <span class="n">iterative_min_size</span><span class="o">=</span><span class="n">iterative_min_size</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">flood_depth_window</span> <span class="o">=</span> <span class="n">flood_depth</span><span class="p">[</span><span class="n">min0</span><span class="p">:</span><span class="n">max0</span><span class="p">,</span> <span class="n">min1</span><span class="p">:</span><span class="n">max1</span><span class="p">]</span>
        <span class="n">flood_depth_window</span><span class="p">[</span><span class="n">flood_window</span> <span class="o">==</span> <span class="n">ll</span><span class="p">]</span> <span class="o">=</span> <span class="n">water_height</span> <span class="o">-</span> <span class="n">hand_window</span><span class="p">[</span><span class="n">flood_window</span> <span class="o">==</span> <span class="n">ll</span><span class="p">]</span>

    <span class="n">flood_depth</span><span class="p">[</span><span class="n">flood_depth</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span>
    <span class="n">flood_depth</span><span class="p">[</span><span class="n">padding_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodata</span>

    <span class="n">floodmask_nodata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
    <span class="n">flood_mask_byte</span> <span class="o">=</span> <span class="n">flood_mask</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">flood_mask_byte</span><span class="p">[</span><span class="n">padding_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">floodmask_nodata</span>

    <span class="n">write_cog</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">out_raster</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">estimator</span><span class="si">}</span><span class="s1">_WaterDepth.tif&#39;</span><span class="p">),</span>
        <span class="n">flood_depth</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">geotransform</span><span class="p">,</span>
        <span class="n">epsg_code</span><span class="o">=</span><span class="n">epsg</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float64</span><span class="p">,</span>
        <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">write_cog</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">out_raster</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">estimator</span><span class="si">}</span><span class="s1">_FloodMask.tif&#39;</span><span class="p">),</span>
        <span class="n">flood_mask_byte</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">geotransform</span><span class="p">,</span>
        <span class="n">epsg_code</span><span class="o">=</span><span class="n">epsg</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
        <span class="n">nodata_value</span><span class="o">=</span><span class="n">floodmask_nodata</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">flood_mask</span><span class="p">[</span><span class="n">known_water_mask</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
    <span class="n">flood_depth</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">logical_not</span><span class="p">(</span><span class="n">flood_mask</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">flood_depth</span><span class="p">[</span><span class="n">padding_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodata</span>
    <span class="n">write_cog</span><span class="p">(</span>
        <span class="nb">str</span><span class="p">(</span><span class="n">out_raster</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">estimator</span><span class="si">}</span><span class="s1">_FloodDepth.tif&#39;</span><span class="p">),</span>
        <span class="n">flood_depth</span><span class="p">,</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">geotransform</span><span class="p">,</span>
        <span class="n">epsg_code</span><span class="o">=</span><span class="n">epsg</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float64</span><span class="p">,</span>
        <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="asf_tools.hydrosar.hand" class="doc doc-heading">
            <code>hand</code>


<a href="#asf_tools.hydrosar.hand" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.hand.calculate_hand_for_basins" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_hand_for_basins</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">geometries</span><span class="p">,</span> <span class="n">dem_file</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.calculate_hand_for_basins" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Calculate the Height Above Nearest Drainage (HAND) for watershed boundaries (hydrobasins).</p>
<p>For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HAND GeoTIFF to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometries</code>
            </td>
            <td>
                  <code><span title="shapely.geometry.GeometryCollection">GeometryCollection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>watershed boundary (hydrobasin) polygons to calculate HAND over</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dem_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DEM raster covering (containing) <code>geometries</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_thresh</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accumulation threshold for determining the drainage mask.
If <code>None</code>, the mean accumulation value is used</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/calculate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_hand_for_basins</span><span class="p">(</span>
    <span class="n">out_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">geometries</span><span class="p">:</span> <span class="n">GeometryCollection</span><span class="p">,</span>
    <span class="n">dem_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">acc_thresh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Height Above Nearest Drainage (HAND) for watershed boundaries (hydrobasins).</span>

<span class="sd">    For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</span>

<span class="sd">    Args:</span>
<span class="sd">        out_raster: HAND GeoTIFF to create</span>
<span class="sd">        geometries: watershed boundary (hydrobasin) polygons to calculate HAND over</span>
<span class="sd">        dem_file: DEM raster covering (containing) `geometries`</span>
<span class="sd">        acc_thresh: Accumulation threshold for determining the drainage mask.</span>
<span class="sd">            If `None`, the mean accumulation value is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dem_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">basin_mask</span><span class="p">,</span> <span class="n">basin_affine_tf</span><span class="p">,</span> <span class="n">basin_window</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster_geometry_mask</span><span class="p">(</span>
            <span class="n">src</span><span class="p">,</span> <span class="n">geometries</span><span class="o">.</span><span class="n">geoms</span><span class="p">,</span> <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">basin_array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">basin_window</span><span class="p">)</span>

        <span class="n">hand</span> <span class="o">=</span> <span class="n">calculate_hand</span><span class="p">(</span><span class="n">basin_array</span><span class="p">,</span> <span class="n">basin_affine_tf</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">basin_mask</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="n">acc_thresh</span><span class="p">)</span>

        <span class="n">write_cog</span><span class="p">(</span>
            <span class="n">out_raster</span><span class="p">,</span>
            <span class="n">hand</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">basin_affine_tf</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">(),</span>
            <span class="n">epsg_code</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">(),</span>
            <span class="n">nodata_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.hand.make_copernicus_hand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_copernicus_hand</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">vector_file</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.make_copernicus_hand" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Copernicus GLO-30 Height Above Nearest Drainage (HAND)</p>
<p>Make a Height Above Nearest Drainage (HAND) GeoTIFF from the Copernicus GLO-30 DEM
covering the watershed boundaries (hydrobasins) defined in a vector file.</p>
<p>For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HAND GeoTIFF to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vector file of watershed boundary (hydrobasin) polygons to calculate HAND over</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_thresh</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accumulation threshold for determining the drainage mask.
If <code>None</code>, the mean accumulation value is used</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/calculate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_copernicus_hand</span><span class="p">(</span>
    <span class="n">out_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">acc_thresh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copernicus GLO-30 Height Above Nearest Drainage (HAND)</span>

<span class="sd">    Make a Height Above Nearest Drainage (HAND) GeoTIFF from the Copernicus GLO-30 DEM</span>
<span class="sd">    covering the watershed boundaries (hydrobasins) defined in a vector file.</span>

<span class="sd">    For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</span>

<span class="sd">    Args:</span>
<span class="sd">        out_raster: HAND GeoTIFF to create</span>
<span class="sd">        vector_file: Vector file of watershed boundary (hydrobasin) polygons to calculate HAND over</span>
<span class="sd">        acc_thresh: Accumulation threshold for determining the drainage mask.</span>
<span class="sd">            If `None`, the mean accumulation value is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">vector_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">vds</span><span class="p">:</span>
        <span class="n">geometries</span> <span class="o">=</span> <span class="n">GeometryCollection</span><span class="p">([</span><span class="n">shape</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">vds</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.vrt&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">dem_vrt</span><span class="p">:</span>
        <span class="n">prepare_dem_vrt</span><span class="p">(</span><span class="n">dem_vrt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">geometries</span><span class="p">)</span>
        <span class="n">calculate_hand_for_basins</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">geometries</span><span class="p">,</span> <span class="n">dem_vrt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="n">acc_thresh</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.hand.prepare_hand_vrt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_hand_vrt</span><span class="p">(</span><span class="n">vrt</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.prepare_hand_vrt" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Prepare a HAND mosaic VRT covering a given geometry</p>
<p>Prepare a Height Above Nearest Drainage (HAND) virtual raster (VRT) covering a given geometry.
The Height Above Nearest Drainage (HAND) mosaic is assembled from the HAND tiles that intersect
the geometry, using a HAND derived from the Copernicus GLO-30 DEM.</p>
<p>Note: <code>asf_tools</code> does not currently support geometries that cross the antimeridian.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vrt</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path for the output VRT file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code><span title="osgeo.ogr.Geometry">Geometry</span> | <span title="shapely.geometry.base.BaseGeometry">BaseGeometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometry in EPSG:4326 (lon/lat) projection for which to prepare a HAND mosaic</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/prepare.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_hand_vrt</span><span class="p">(</span><span class="n">vrt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">geometry</span><span class="p">:</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span> <span class="o">|</span> <span class="n">BaseGeometry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare a HAND mosaic VRT covering a given geometry</span>

<span class="sd">    Prepare a Height Above Nearest Drainage (HAND) virtual raster (VRT) covering a given geometry.</span>
<span class="sd">    The Height Above Nearest Drainage (HAND) mosaic is assembled from the HAND tiles that intersect</span>
<span class="sd">    the geometry, using a HAND derived from the Copernicus GLO-30 DEM.</span>

<span class="sd">    Note: `asf_tools` does not currently support geometries that cross the antimeridian.</span>

<span class="sd">    Args:</span>
<span class="sd">        vrt: Path for the output VRT file</span>
<span class="sd">        geometry: Geometry in EPSG:4326 (lon/lat) projection for which to prepare a HAND mosaic</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">GDALConfigManager</span><span class="p">(</span><span class="n">GDAL_DISABLE_READDIR_ON_OPEN</span><span class="o">=</span><span class="s1">&#39;EMPTY_DIR&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">BaseGeometry</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkb</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">wkb</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">)</span>
        <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">min_lon</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">160.0</span> <span class="ow">and</span> <span class="n">max_lon</span> <span class="o">&gt;</span> <span class="mf">160.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;asf_tools does not currently support geometries that cross the antimeridian: </span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">tile_features</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">HAND_GEOJSON</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vector</span><span class="o">.</span><span class="n">get_property_values_for_intersecting_features</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">tile_features</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copernicus GLO-30 HAND does not intersect this geometry: </span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">hand_file_paths</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">intersecting_feature_properties</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">tile_features</span><span class="p">,</span> <span class="s1">&#39;file_path&#39;</span><span class="p">)</span>

        <span class="n">gdal</span><span class="o">.</span><span class="n">BuildVRT</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrt</span><span class="p">),</span> <span class="n">hand_file_paths</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>


<div class="doc doc-object doc-module">



<h4 id="asf_tools.hydrosar.hand.calculate" class="doc doc-heading">
            <code>calculate</code>


<a href="#asf_tools.hydrosar.hand.calculate" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Calculate Height Above Nearest Drainage (HAND) from the Copernicus GLO-30 DEM</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="asf_tools.hydrosar.hand.calculate.calculate_hand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_hand</span><span class="p">(</span><span class="n">dem_array</span><span class="p">,</span> <span class="n">dem_affine</span><span class="p">,</span> <span class="n">dem_crs</span><span class="p">,</span> <span class="n">basin_mask</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.calculate.calculate_hand" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Calculate the Height Above Nearest Drainage (HAND)</p>
<p>Calculate the Height Above Nearest Drainage (HAND) using pySHEDS library. Because HAND
 is tied to watershed boundaries (hydrobasins), clipped/cut basins will produce weird edge
 effects, and incomplete basins should be masked out. For watershed boundaries,
 see: https://www.hydrosheds.org/page/hydrobasins</p>
<p>This involves:
    * Filling pits (single-cells lower than their surrounding neighbors)
        in the Digital Elevation Model (DEM)
    * Filling depressions (regions of cells lower than their surrounding neighbors)
        in the Digital Elevation Model (DEM)
    * Resolving un-drainable flats
    * Determining the flow direction using the ESRI D8 routing scheme
    * Determining flow accumulation (number of upstream cells)
    * Creating a drainage mask using the accumulation threshold <code>acc_thresh</code>
    * Calculating HAND</p>
<p>In the HAND calculation, NaNs inside the basin filled using <code>fill_hand</code></p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>dem_array</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DEM to calculate HAND for</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dem_crs</code>
            </td>
            <td>
                  <code><span title="rasterio.crs.CRS">CRS</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DEM Coordinate Reference System (CRS)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dem_affine</code>
            </td>
            <td>
                  <code><span title="rasterio.Affine">Affine</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DEM Affine geotransform</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>basin_mask</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Array of booleans indicating wither an element should be masked out ( la Numpy Masked Arrays:
https://numpy.org/doc/stable/reference/maskedarray.generic.html#what-is-a-masked-array)</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_thresh</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accumulation threshold for determining the drainage mask.
If <code>None</code>, the mean accumulation value is used</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/calculate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_hand</span><span class="p">(</span>
    <span class="n">dem_array</span><span class="p">,</span>
    <span class="n">dem_affine</span><span class="p">:</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">Affine</span><span class="p">,</span>
    <span class="n">dem_crs</span><span class="p">:</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">CRS</span><span class="p">,</span>
    <span class="n">basin_mask</span><span class="p">,</span>
    <span class="n">acc_thresh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Height Above Nearest Drainage (HAND)</span>

<span class="sd">     Calculate the Height Above Nearest Drainage (HAND) using pySHEDS library. Because HAND</span>
<span class="sd">     is tied to watershed boundaries (hydrobasins), clipped/cut basins will produce weird edge</span>
<span class="sd">     effects, and incomplete basins should be masked out. For watershed boundaries,</span>
<span class="sd">     see: https://www.hydrosheds.org/page/hydrobasins</span>

<span class="sd">     This involves:</span>
<span class="sd">        * Filling pits (single-cells lower than their surrounding neighbors)</span>
<span class="sd">            in the Digital Elevation Model (DEM)</span>
<span class="sd">        * Filling depressions (regions of cells lower than their surrounding neighbors)</span>
<span class="sd">            in the Digital Elevation Model (DEM)</span>
<span class="sd">        * Resolving un-drainable flats</span>
<span class="sd">        * Determining the flow direction using the ESRI D8 routing scheme</span>
<span class="sd">        * Determining flow accumulation (number of upstream cells)</span>
<span class="sd">        * Creating a drainage mask using the accumulation threshold `acc_thresh`</span>
<span class="sd">        * Calculating HAND</span>

<span class="sd">    In the HAND calculation, NaNs inside the basin filled using `fill_hand`</span>

<span class="sd">    Args:</span>
<span class="sd">        dem_array: DEM to calculate HAND for</span>
<span class="sd">        dem_crs: DEM Coordinate Reference System (CRS)</span>
<span class="sd">        dem_affine: DEM Affine geotransform</span>
<span class="sd">        basin_mask: Array of booleans indicating wither an element should be masked out ( la Numpy Masked Arrays:</span>
<span class="sd">            https://numpy.org/doc/stable/reference/maskedarray.generic.html#what-is-a-masked-array)</span>
<span class="sd">        acc_thresh: Accumulation threshold for determining the drainage mask.</span>
<span class="sd">            If `None`, the mean accumulation value is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">nodata_fill_value</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span><span class="o">.</span><span class="n">eps</span>
    <span class="k">with</span> <span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
        <span class="n">write_cog</span><span class="p">(</span>
            <span class="n">temp_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">dem_array</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">dem_affine</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">(),</span>
            <span class="n">epsg_code</span><span class="o">=</span><span class="n">dem_crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">(),</span>
            <span class="c1"># Prevents PySheds from assuming using zero as the nodata value</span>
            <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata_fill_value</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="c1"># From PySheds; see example usage: http://mattbartos.com/pysheds/</span>
        <span class="n">grid</span> <span class="o">=</span> <span class="n">sGrid</span><span class="o">.</span><span class="n">from_raster</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">temp_file</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>
        <span class="n">dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">read_raster</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">temp_file</span><span class="o">.</span><span class="n">name</span><span class="p">))</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Fill pits in DEM&#39;</span><span class="p">)</span>
    <span class="n">pit_filled_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fill_pits</span><span class="p">(</span><span class="n">dem</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Filling depressions&#39;</span><span class="p">)</span>
    <span class="n">flooded_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">fill_depressions</span><span class="p">(</span><span class="n">pit_filled_dem</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">pit_filled_dem</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Resolving flats&#39;</span><span class="p">)</span>
    <span class="n">inflated_dem</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">resolve_flats</span><span class="p">(</span><span class="n">flooded_dem</span><span class="p">)</span>
    <span class="k">del</span> <span class="n">flooded_dem</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Obtaining flow direction&#39;</span><span class="p">)</span>
    <span class="n">flow_dir</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">flowdir</span><span class="p">(</span><span class="n">inflated_dem</span><span class="p">,</span> <span class="n">apply_mask</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Calculating flow accumulation&#39;</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">accumulation</span><span class="p">(</span><span class="n">flow_dir</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">acc_thresh</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">acc_thresh</span> <span class="o">=</span> <span class="n">acc</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Calculating HAND using accumulation threshold of </span><span class="si">{</span><span class="n">acc_thresh</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">hand</span> <span class="o">=</span> <span class="n">grid</span><span class="o">.</span><span class="n">compute_hand</span><span class="p">(</span><span class="n">flow_dir</span><span class="p">,</span> <span class="n">inflated_dem</span><span class="p">,</span> <span class="n">acc</span> <span class="o">&gt;</span> <span class="n">acc_thresh</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hand</span><span class="p">)</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Filling NaNs in the HAND&#39;</span><span class="p">)</span>
        <span class="c1"># mask outside of basin with a not-NaN value to prevent NaN-filling outside of basin (optimization)</span>
        <span class="n">hand</span><span class="p">[</span><span class="n">basin_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodata_fill_value</span>
        <span class="n">hand</span> <span class="o">=</span> <span class="n">fill_hand</span><span class="p">(</span><span class="n">hand</span><span class="p">,</span> <span class="n">dem_array</span><span class="p">)</span>

    <span class="c1"># set pixels outside of basin to nodata</span>
    <span class="n">hand</span><span class="p">[</span><span class="n">basin_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># TODO: also mask ocean pixels here?</span>

    <span class="k">return</span> <span class="n">hand</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="asf_tools.hydrosar.hand.calculate.calculate_hand_for_basins" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">calculate_hand_for_basins</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">geometries</span><span class="p">,</span> <span class="n">dem_file</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.calculate.calculate_hand_for_basins" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Calculate the Height Above Nearest Drainage (HAND) for watershed boundaries (hydrobasins).</p>
<p>For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HAND GeoTIFF to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometries</code>
            </td>
            <td>
                  <code><span title="shapely.geometry.GeometryCollection">GeometryCollection</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>watershed boundary (hydrobasin) polygons to calculate HAND over</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dem_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>DEM raster covering (containing) <code>geometries</code></p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_thresh</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accumulation threshold for determining the drainage mask.
If <code>None</code>, the mean accumulation value is used</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/calculate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">calculate_hand_for_basins</span><span class="p">(</span>
    <span class="n">out_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">geometries</span><span class="p">:</span> <span class="n">GeometryCollection</span><span class="p">,</span>
    <span class="n">dem_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">acc_thresh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Calculate the Height Above Nearest Drainage (HAND) for watershed boundaries (hydrobasins).</span>

<span class="sd">    For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</span>

<span class="sd">    Args:</span>
<span class="sd">        out_raster: HAND GeoTIFF to create</span>
<span class="sd">        geometries: watershed boundary (hydrobasin) polygons to calculate HAND over</span>
<span class="sd">        dem_file: DEM raster covering (containing) `geometries`</span>
<span class="sd">        acc_thresh: Accumulation threshold for determining the drainage mask.</span>
<span class="sd">            If `None`, the mean accumulation value is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">dem_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">src</span><span class="p">:</span>
        <span class="n">basin_mask</span><span class="p">,</span> <span class="n">basin_affine_tf</span><span class="p">,</span> <span class="n">basin_window</span> <span class="o">=</span> <span class="n">rasterio</span><span class="o">.</span><span class="n">mask</span><span class="o">.</span><span class="n">raster_geometry_mask</span><span class="p">(</span>
            <span class="n">src</span><span class="p">,</span> <span class="n">geometries</span><span class="o">.</span><span class="n">geoms</span><span class="p">,</span> <span class="n">all_touched</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">crop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">pad_width</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="n">basin_array</span> <span class="o">=</span> <span class="n">src</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="n">basin_window</span><span class="p">)</span>

        <span class="n">hand</span> <span class="o">=</span> <span class="n">calculate_hand</span><span class="p">(</span><span class="n">basin_array</span><span class="p">,</span> <span class="n">basin_affine_tf</span><span class="p">,</span> <span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="p">,</span> <span class="n">basin_mask</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="n">acc_thresh</span><span class="p">)</span>

        <span class="n">write_cog</span><span class="p">(</span>
            <span class="n">out_raster</span><span class="p">,</span>
            <span class="n">hand</span><span class="p">,</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">basin_affine_tf</span><span class="o">.</span><span class="n">to_gdal</span><span class="p">(),</span>
            <span class="n">epsg_code</span><span class="o">=</span><span class="n">src</span><span class="o">.</span><span class="n">crs</span><span class="o">.</span><span class="n">to_epsg</span><span class="p">(),</span>
            <span class="n">nodata_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="asf_tools.hydrosar.hand.calculate.fill_hand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_hand</span><span class="p">(</span><span class="n">hand</span><span class="p">,</span> <span class="n">dem</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.calculate.fill_hand" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Replace NaNs in a HAND array with values interpolated from their neighbor's HOND</p>
<p>Replace NaNs in a HAND array with values interpolated from their neighbor's HOND (height of nearest drainage)
using a 2D Gaussian kernel. Here, HOND is defined as the DEM value less the HAND value. For the kernel, see:
https://docs.astropy.org/en/stable/convolution/#using-astropy-s-convolution-to-replace-bad-data</p>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/calculate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fill_hand</span><span class="p">(</span><span class="n">hand</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">dem</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace NaNs in a HAND array with values interpolated from their neighbor&#39;s HOND</span>

<span class="sd">    Replace NaNs in a HAND array with values interpolated from their neighbor&#39;s HOND (height of nearest drainage)</span>
<span class="sd">    using a 2D Gaussian kernel. Here, HOND is defined as the DEM value less the HAND value. For the kernel, see:</span>
<span class="sd">    https://docs.astropy.org/en/stable/convolution/#using-astropy-s-convolution-to-replace-bad-data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">hond</span> <span class="o">=</span> <span class="n">dem</span> <span class="o">-</span> <span class="n">hand</span>
    <span class="n">hond</span> <span class="o">=</span> <span class="n">fill_nan</span><span class="p">(</span><span class="n">hond</span><span class="p">)</span>

    <span class="n">hand_mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">hand</span><span class="p">)</span>
    <span class="n">hand</span><span class="p">[</span><span class="n">hand_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">dem</span><span class="p">[</span><span class="n">hand_mask</span><span class="p">]</span> <span class="o">-</span> <span class="n">hond</span><span class="p">[</span><span class="n">hand_mask</span><span class="p">]</span>
    <span class="n">hand</span><span class="p">[</span><span class="n">hand</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

    <span class="k">return</span> <span class="n">hand</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="asf_tools.hydrosar.hand.calculate.fill_nan" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">fill_nan</span><span class="p">(</span><span class="n">array</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.calculate.fill_nan" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Replace NaNs with values interpolated from their neighbors</p>
<p>Replace NaNs with values interpolated from their neighbors using a 2D Gaussian
kernel, see: https://docs.astropy.org/en/stable/convolution/#using-astropy-s-convolution-to-replace-bad-data</p>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/calculate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">fill_nan</span><span class="p">(</span><span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Replace NaNs with values interpolated from their neighbors</span>

<span class="sd">    Replace NaNs with values interpolated from their neighbors using a 2D Gaussian</span>
<span class="sd">    kernel, see: https://docs.astropy.org/en/stable/convolution/#using-astropy-s-convolution-to-replace-bad-data</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">kernel</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">convolution</span><span class="o">.</span><span class="n">Gaussian2DKernel</span><span class="p">(</span><span class="n">x_stddev</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># kernel x_size=8*stddev</span>
    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">simplefilter</span><span class="p">(</span><span class="s1">&#39;ignore&#39;</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">array</span><span class="p">)):</span>
            <span class="n">array</span> <span class="o">=</span> <span class="n">astropy</span><span class="o">.</span><span class="n">convolution</span><span class="o">.</span><span class="n">interpolate_replace_nans</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">kernel</span><span class="p">,</span> <span class="n">convolve</span><span class="o">=</span><span class="n">astropy</span><span class="o">.</span><span class="n">convolution</span><span class="o">.</span><span class="n">convolve</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="asf_tools.hydrosar.hand.calculate.make_copernicus_hand" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_copernicus_hand</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">vector_file</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.calculate.make_copernicus_hand" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Copernicus GLO-30 Height Above Nearest Drainage (HAND)</p>
<p>Make a Height Above Nearest Drainage (HAND) GeoTIFF from the Copernicus GLO-30 DEM
covering the watershed boundaries (hydrobasins) defined in a vector file.</p>
<p>For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>HAND GeoTIFF to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vector_file</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Vector file of watershed boundary (hydrobasin) polygons to calculate HAND over</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>acc_thresh</code>
            </td>
            <td>
                  <code><span title="int">int</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Accumulation threshold for determining the drainage mask.
If <code>None</code>, the mean accumulation value is used</p>
              </div>
            </td>
            <td>
                  <code>100</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/calculate.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_copernicus_hand</span><span class="p">(</span>
    <span class="n">out_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">vector_file</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">acc_thresh</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="mi">100</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Copernicus GLO-30 Height Above Nearest Drainage (HAND)</span>

<span class="sd">    Make a Height Above Nearest Drainage (HAND) GeoTIFF from the Copernicus GLO-30 DEM</span>
<span class="sd">    covering the watershed boundaries (hydrobasins) defined in a vector file.</span>

<span class="sd">    For watershed boundaries, see: https://www.hydrosheds.org/page/hydrobasins</span>

<span class="sd">    Args:</span>
<span class="sd">        out_raster: HAND GeoTIFF to create</span>
<span class="sd">        vector_file: Vector file of watershed boundary (hydrobasin) polygons to calculate HAND over</span>
<span class="sd">        acc_thresh: Accumulation threshold for determining the drainage mask.</span>
<span class="sd">            If `None`, the mean accumulation value is used</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">fiona</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">vector_file</span><span class="p">)</span> <span class="k">as</span> <span class="n">vds</span><span class="p">:</span>
        <span class="n">geometries</span> <span class="o">=</span> <span class="n">GeometryCollection</span><span class="p">([</span><span class="n">shape</span><span class="p">(</span><span class="n">feature</span><span class="p">[</span><span class="s1">&#39;geometry&#39;</span><span class="p">])</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">vds</span><span class="p">])</span>

    <span class="k">with</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.vrt&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">dem_vrt</span><span class="p">:</span>
        <span class="n">prepare_dem_vrt</span><span class="p">(</span><span class="n">dem_vrt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">geometries</span><span class="p">)</span>
        <span class="n">calculate_hand_for_basins</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">geometries</span><span class="p">,</span> <span class="n">dem_vrt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">acc_thresh</span><span class="o">=</span><span class="n">acc_thresh</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h4 id="asf_tools.hydrosar.hand.prepare" class="doc doc-heading">
            <code>prepare</code>


<a href="#asf_tools.hydrosar.hand.prepare" class="headerlink" title="Permanent link">&para;</a></h4>

    <div class="doc doc-contents ">

        <p>Prepare a Height Above Nearest Drainage (HAND) virtual raster (VRT) covering a given geometry</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h5 id="asf_tools.hydrosar.hand.prepare.prepare_hand_for_raster" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_hand_for_raster</span><span class="p">(</span><span class="n">hand_raster</span><span class="p">,</span> <span class="n">source_raster</span><span class="p">,</span> <span class="n">resampling_method</span><span class="o">=</span><span class="s1">&#39;lanczos&#39;</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.prepare.prepare_hand_for_raster" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Create a HAND raster pixel-aligned to a source raster</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>hand_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path for the output HAND raster</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>source_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path for the source raster</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>resampling_method</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Name of the resampling method to use. For available methods, see:
https://gdal.org/programs/gdalwarp.html#cmdoption-gdalwarp-r</p>
              </div>
            </td>
            <td>
                  <code>&#39;lanczos&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/prepare.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_hand_for_raster</span><span class="p">(</span>
    <span class="n">hand_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">source_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">resampling_method</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;lanczos&#39;</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Create a HAND raster pixel-aligned to a source raster</span>

<span class="sd">    Args:</span>
<span class="sd">        hand_raster: Path for the output HAND raster</span>
<span class="sd">        source_raster: Path for the source raster</span>
<span class="sd">        resampling_method: Name of the resampling method to use. For available methods, see:</span>
<span class="sd">            https://gdal.org/programs/gdalwarp.html#cmdoption-gdalwarp-r</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">info</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">source_raster</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>

    <span class="n">hand_geometry</span> <span class="o">=</span> <span class="n">shape</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;wgs84Extent&#39;</span><span class="p">])</span>
    <span class="n">hand_bounds</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;upperLeft&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;lowerRight&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;lowerRight&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
        <span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;upperLeft&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
    <span class="p">]</span>

    <span class="k">with</span> <span class="n">NamedTemporaryFile</span><span class="p">(</span><span class="n">suffix</span><span class="o">=</span><span class="s1">&#39;.vrt&#39;</span><span class="p">,</span> <span class="n">delete</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span> <span class="k">as</span> <span class="n">hand_vrt</span><span class="p">:</span>
        <span class="n">prepare_hand_vrt</span><span class="p">(</span><span class="n">hand_vrt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">hand_geometry</span><span class="p">)</span>
        <span class="n">gdal</span><span class="o">.</span><span class="n">Warp</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">hand_raster</span><span class="p">),</span>
            <span class="n">hand_vrt</span><span class="o">.</span><span class="n">name</span><span class="p">,</span>
            <span class="n">dstSRS</span><span class="o">=</span><span class="sa">f</span><span class="s1">&#39;EPSG:</span><span class="si">{</span><span class="n">get_epsg_code</span><span class="p">(</span><span class="n">info</span><span class="p">)</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">,</span>
            <span class="n">outputBounds</span><span class="o">=</span><span class="n">hand_bounds</span><span class="p">,</span>
            <span class="n">width</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">height</span><span class="o">=</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;size&#39;</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">resampleAlg</span><span class="o">=</span><span class="n">Resampling</span><span class="p">[</span><span class="n">resampling_method</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h5 id="asf_tools.hydrosar.hand.prepare.prepare_hand_vrt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">prepare_hand_vrt</span><span class="p">(</span><span class="n">vrt</span><span class="p">,</span> <span class="n">geometry</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.hand.prepare.prepare_hand_vrt" class="headerlink" title="Permanent link">&para;</a></h5>


    <div class="doc doc-contents ">

        <p>Prepare a HAND mosaic VRT covering a given geometry</p>
<p>Prepare a Height Above Nearest Drainage (HAND) virtual raster (VRT) covering a given geometry.
The Height Above Nearest Drainage (HAND) mosaic is assembled from the HAND tiles that intersect
the geometry, using a HAND derived from the Copernicus GLO-30 DEM.</p>
<p>Note: <code>asf_tools</code> does not currently support geometries that cross the antimeridian.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>vrt</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Path for the output VRT file</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>geometry</code>
            </td>
            <td>
                  <code><span title="osgeo.ogr.Geometry">Geometry</span> | <span title="shapely.geometry.base.BaseGeometry">BaseGeometry</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Geometry in EPSG:4326 (lon/lat) projection for which to prepare a HAND mosaic</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/hand/prepare.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">prepare_hand_vrt</span><span class="p">(</span><span class="n">vrt</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">geometry</span><span class="p">:</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span> <span class="o">|</span> <span class="n">BaseGeometry</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Prepare a HAND mosaic VRT covering a given geometry</span>

<span class="sd">    Prepare a Height Above Nearest Drainage (HAND) virtual raster (VRT) covering a given geometry.</span>
<span class="sd">    The Height Above Nearest Drainage (HAND) mosaic is assembled from the HAND tiles that intersect</span>
<span class="sd">    the geometry, using a HAND derived from the Copernicus GLO-30 DEM.</span>

<span class="sd">    Note: `asf_tools` does not currently support geometries that cross the antimeridian.</span>

<span class="sd">    Args:</span>
<span class="sd">        vrt: Path for the output VRT file</span>
<span class="sd">        geometry: Geometry in EPSG:4326 (lon/lat) projection for which to prepare a HAND mosaic</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="n">GDALConfigManager</span><span class="p">(</span><span class="n">GDAL_DISABLE_READDIR_ON_OPEN</span><span class="o">=</span><span class="s1">&#39;EMPTY_DIR&#39;</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">BaseGeometry</span><span class="p">):</span>
            <span class="n">geometry</span> <span class="o">=</span> <span class="n">ogr</span><span class="o">.</span><span class="n">CreateGeometryFromWkb</span><span class="p">(</span><span class="n">geometry</span><span class="o">.</span><span class="n">wkb</span><span class="p">)</span>

        <span class="k">assert</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">ogr</span><span class="o">.</span><span class="n">Geometry</span><span class="p">)</span>
        <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">,</span> <span class="n">_</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">geometry</span><span class="o">.</span><span class="n">GetEnvelope</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">min_lon</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">160.0</span> <span class="ow">and</span> <span class="n">max_lon</span> <span class="o">&gt;</span> <span class="mf">160.0</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;asf_tools does not currently support geometries that cross the antimeridian: </span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">tile_features</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">get_features</span><span class="p">(</span><span class="n">HAND_GEOJSON</span><span class="p">)</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">vector</span><span class="o">.</span><span class="n">get_property_values_for_intersecting_features</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">tile_features</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Copernicus GLO-30 HAND does not intersect this geometry: </span><span class="si">{</span><span class="n">geometry</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">hand_file_paths</span> <span class="o">=</span> <span class="n">vector</span><span class="o">.</span><span class="n">intersecting_feature_properties</span><span class="p">(</span><span class="n">geometry</span><span class="p">,</span> <span class="n">tile_features</span><span class="p">,</span> <span class="s1">&#39;file_path&#39;</span><span class="p">)</span>

        <span class="n">gdal</span><span class="o">.</span><span class="n">BuildVRT</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vrt</span><span class="p">),</span> <span class="n">hand_file_paths</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="asf_tools.hydrosar.threshold" class="doc doc-heading">
            <code>threshold</code>


<a href="#asf_tools.hydrosar.threshold" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.threshold.expectation_maximization_threshold" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">expectation_maximization_threshold</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.threshold.expectation_maximization_threshold" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Water threshold Calculation using a multi-mode Expectation Maximization Approach</p>
<p>Thresholding works best when backscatter tiles are provided on a decibel scale
to get Gaussian distribution that is scaled to a range of 0-255, and performed
on a small tile that is likely to have a transition between water and not water.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tile</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>array of backscatter values for a tile from an RTC raster</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>number_of_classes</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>classify the tile into this many classes. Typically, three
classes capture: (1) urban and bright slopes, (2) average brightness farmland,
and (3) water, as is often seen in the US Midwest.</p>
              </div>
            </td>
            <td>
                  <code>3</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>threshold</code></td>            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>threshold value that can be used to create a water extent map</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/threshold.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">expectation_maximization_threshold</span><span class="p">(</span><span class="n">tile</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Water threshold Calculation using a multi-mode Expectation Maximization Approach</span>

<span class="sd">    Thresholding works best when backscatter tiles are provided on a decibel scale</span>
<span class="sd">    to get Gaussian distribution that is scaled to a range of 0-255, and performed</span>
<span class="sd">    on a small tile that is likely to have a transition between water and not water.</span>


<span class="sd">    Args:</span>
<span class="sd">        tile: array of backscatter values for a tile from an RTC raster</span>
<span class="sd">        number_of_classes: classify the tile into this many classes. Typically, three</span>
<span class="sd">            classes capture: (1) urban and bright slopes, (2) average brightness farmland,</span>
<span class="sd">            and (3) water, as is often seen in the US Midwest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        threshold: threshold value that can be used to create a water extent map</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">image_copy</span> <span class="o">=</span> <span class="n">tile</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">image_copy2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">filled</span><span class="p">(</span><span class="n">tile</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>  <span class="c1"># needed for valid posterior_lookup keys</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">tile</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">minimum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amin</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">image</span> <span class="o">=</span> <span class="n">image</span> <span class="o">-</span> <span class="n">minimum</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">maximum</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>

    <span class="n">histogram</span> <span class="o">=</span> <span class="n">_make_histogram</span><span class="p">(</span><span class="n">image</span><span class="p">)</span>
    <span class="n">nonzero_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nonzero</span><span class="p">(</span><span class="n">histogram</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">histogram</span> <span class="o">=</span> <span class="n">histogram</span><span class="p">[</span><span class="n">nonzero_indices</span><span class="p">]</span>
    <span class="n">histogram</span> <span class="o">=</span> <span class="n">histogram</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">class_means</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">number_of_classes</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">maximum</span> <span class="o">/</span> <span class="p">(</span><span class="n">number_of_classes</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">class_variances</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_of_classes</span><span class="p">)</span> <span class="o">*</span> <span class="n">maximum</span>
    <span class="n">class_proportions</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">number_of_classes</span><span class="p">)</span> <span class="o">*</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">number_of_classes</span>
    <span class="n">sml</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">nonzero_indices</span><span class="p">))</span> <span class="o">/</span> <span class="mi">1000</span>
    <span class="n">iteration</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="n">class_likelihood</span> <span class="o">=</span> <span class="n">_make_distribution</span><span class="p">(</span><span class="n">class_means</span><span class="p">,</span> <span class="n">class_variances</span><span class="p">,</span> <span class="n">class_proportions</span><span class="p">,</span> <span class="n">nonzero_indices</span><span class="p">)</span>
        <span class="n">sum_likelihood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">class_likelihood</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">class_likelihood</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">eps</span>
        <span class="n">log_likelihood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">histogram</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sum_likelihood</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">):</span>
            <span class="n">class_posterior_probability</span> <span class="o">=</span> <span class="n">histogram</span> <span class="o">*</span> <span class="n">class_likelihood</span><span class="p">[:,</span> <span class="n">j</span><span class="p">]</span> <span class="o">/</span> <span class="n">sum_likelihood</span>
            <span class="n">class_proportions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">class_posterior_probability</span><span class="p">)</span>
            <span class="n">class_means</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">nonzero_indices</span> <span class="o">*</span> <span class="n">class_posterior_probability</span><span class="p">)</span> <span class="o">/</span> <span class="n">class_proportions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">vr</span> <span class="o">=</span> <span class="n">nonzero_indices</span> <span class="o">-</span> <span class="n">class_means</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
            <span class="n">class_variances</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">vr</span> <span class="o">*</span> <span class="n">vr</span> <span class="o">*</span> <span class="n">class_posterior_probability</span><span class="p">)</span> <span class="o">/</span> <span class="n">class_proportions</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">+</span> <span class="n">sml</span>
            <span class="k">del</span> <span class="n">class_posterior_probability</span><span class="p">,</span> <span class="n">vr</span>
        <span class="n">class_proportions</span> <span class="o">+=</span> <span class="mf">1e-3</span>
        <span class="n">class_proportions</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">class_proportions</span><span class="p">)</span>
        <span class="n">class_likelihood</span> <span class="o">=</span> <span class="n">_make_distribution</span><span class="p">(</span><span class="n">class_means</span><span class="p">,</span> <span class="n">class_variances</span><span class="p">,</span> <span class="n">class_proportions</span><span class="p">,</span> <span class="n">nonzero_indices</span><span class="p">)</span>
        <span class="n">sum_likelihood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">class_likelihood</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">finfo</span><span class="p">(</span><span class="n">class_likelihood</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">])</span><span class="o">.</span><span class="n">eps</span>
        <span class="k">del</span> <span class="n">class_likelihood</span>
        <span class="n">new_log_likelihood</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">histogram</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">sum_likelihood</span><span class="p">))</span>
        <span class="k">del</span> <span class="n">sum_likelihood</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">new_log_likelihood</span> <span class="o">-</span> <span class="n">log_likelihood</span><span class="p">)</span> <span class="o">&lt;</span> <span class="mf">0.000001</span><span class="p">:</span>
            <span class="k">break</span>
        <span class="n">iteration</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="k">del</span> <span class="n">log_likelihood</span><span class="p">,</span> <span class="n">new_log_likelihood</span>
    <span class="n">class_means</span> <span class="o">=</span> <span class="n">class_means</span> <span class="o">+</span> <span class="n">minimum</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">image_copy</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">posterior</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">number_of_classes</span><span class="p">))</span>
    <span class="n">posterior_lookup</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">0</span><span class="p">]):</span>
        <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">s</span><span class="p">[</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">pixel_val</span> <span class="o">=</span> <span class="n">image_copy2</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">]</span>
            <span class="k">if</span> <span class="n">pixel_val</span> <span class="ow">in</span> <span class="n">posterior_lookup</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">):</span>
                    <span class="n">posterior</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">posterior_lookup</span><span class="p">[</span><span class="n">pixel_val</span><span class="p">][</span><span class="n">n</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">posterior_lookup</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">pixel_val</span><span class="p">:</span> <span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">number_of_classes</span><span class="p">})</span>
                <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">number_of_classes</span><span class="p">):</span>
                    <span class="n">x</span> <span class="o">=</span> <span class="n">_make_distribution</span><span class="p">(</span>
                        <span class="n">class_means</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                        <span class="n">class_variances</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                        <span class="n">class_proportions</span><span class="p">[</span><span class="n">n</span><span class="p">],</span>
                        <span class="n">image_copy</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">],</span>
                    <span class="p">)</span>
                    <span class="n">posterior</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">x</span> <span class="o">*</span> <span class="n">class_proportions</span><span class="p">[</span><span class="n">n</span><span class="p">]</span>
                    <span class="n">posterior_lookup</span><span class="p">[</span><span class="n">pixel_val</span><span class="p">][</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">posterior</span><span class="p">[</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">,</span> <span class="n">n</span><span class="p">]</span>

    <span class="n">sorti</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">class_means</span><span class="p">)</span>
    <span class="n">xvec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="n">class_means</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="n">class_means</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span> <span class="n">step</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span>
    <span class="n">x1</span> <span class="o">=</span> <span class="n">_make_distribution</span><span class="p">(</span>
        <span class="n">class_means</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">class_variances</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">class_proportions</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span>
        <span class="n">xvec</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">x2</span> <span class="o">=</span> <span class="n">_make_distribution</span><span class="p">(</span>
        <span class="n">class_means</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">class_variances</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">class_proportions</span><span class="p">[</span><span class="n">sorti</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
        <span class="n">xvec</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">dx</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">xvec</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">argmin</span><span class="p">(</span><span class="n">dx</span><span class="p">)]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="asf_tools.hydrosar.water_map" class="doc doc-heading">
            <code>water_map</code>


<a href="#asf_tools.hydrosar.water_map" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">

        <p>Generate surface water maps from Sentinel-1 RTC products</p>
<p>Create a surface water extent map from a dual-pol Sentinel-1 RTC product and
a HAND image. The HAND image must be pixel-aligned (same extent and size) to
the RTC images. The water extent maps are created using an adaptive Expectation
Maximization thresholding approach and refined using Fuzzy Logic.</p>









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.water_map.format_raster_data" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">format_raster_data</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">padding_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.water_map.format_raster_data" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Ensure raster data is uint8 and set the area outside the valid data to nodata</p>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/water_map.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">format_raster_data</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">padding_mask</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nodata</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Ensure raster data is uint8 and set the area outside the valid data to nodata&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">padding_mask</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">read_as_masked_array</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
        <span class="n">padding_mask</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">mask</span>
    <span class="n">raster</span> <span class="o">=</span> <span class="n">raster</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span>
    <span class="n">raster</span><span class="p">[</span><span class="n">padding_mask</span><span class="p">]</span> <span class="o">=</span> <span class="n">nodata</span>

    <span class="k">return</span> <span class="n">raster</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.hydrosar.water_map.make_water_map" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">make_water_map</span><span class="p">(</span><span class="n">out_raster</span><span class="p">,</span> <span class="n">vv_raster</span><span class="p">,</span> <span class="n">vh_raster</span><span class="p">,</span> <span class="n">hand_raster</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">tile_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span> <span class="n">max_vv_threshold</span><span class="o">=-</span><span class="mf">15.5</span><span class="p">,</span> <span class="n">max_vh_threshold</span><span class="o">=-</span><span class="mf">23.0</span><span class="p">,</span> <span class="n">hand_threshold</span><span class="o">=</span><span class="mf">15.0</span><span class="p">,</span> <span class="n">hand_fraction</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span> <span class="n">membership_threshold</span><span class="o">=</span><span class="mf">0.45</span><span class="p">)</span></code>

<a href="#asf_tools.hydrosar.water_map.make_water_map" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Creates a surface water extent map from a Sentinel-1 RTC product</p>
<p>Create a surface water extent map from a dual-pol Sentinel-1 RTC product and
a HAND image. The HAND image must be pixel-aligned (same extent and size) to
the RTC images. The water extent maps are created using an adaptive Expectation
Maximization thresholding approach and refined with Fuzzy Logic.</p>
<p>The input images are broken into a set of corresponding tiles with a shape of
<code>tile_shape</code>, and a set of tiles are selected from the VH RTC
image that contain water boundaries to determine an appropriate water threshold.
 Candidate tiles must meet these criteria:
* <code>hand_fraction</code> of pixels within a tile must have HAND pixel values lower
  than <code>hand_threshold</code>
* The median backscatter value for the tile must be lower than an average tiles'
  backscatter values
* The tile must have a high variance -- high variance is considered initially to
  be a variance in the 95th percentile of the tile variances, but progressively
  relaxed to the 5th percentile if there not at least 5 candidate tiles.</p>
<p>The 5 VH tiles with the highest variance are selected for thresholding and a
water threshold value is determined using an Expectation Maximization approach.
If there were not enough candidate tiles or the threshold is too high,
<code>max_vh_threshold</code> and/or <code>max_vv_threshold</code> will be used instead.</p>
<p>From the initial threshold-based water extent maps, Fuzzy Logic is used to remove
spurious false detections and improve the water extent map quality. The fuzzy logic
uses these indicators for the presence of water:
* radar cross section in a pixel relative to the determined detection threshold
* the height above nearest drainage (HAND)
* the surface slope, which is derived from the HAND data
* the size of the detected water feature</p>
<p>For each indicator, a Z-shaped activation function is used to determine pixel membership.
The membership maps are combined to form the final water extent map. Pixels classified
as water pixels will:
* have non-zero membership in all of the indicators, and
* have an average membership above the <code>membership_threshold</code> value.</p>
<p>Finally, the VV and VH water masks will be combined to include all water pixels
from both masks, and the combined water map will be written to <code>out_raster</code>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>out_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Water map GeoTIFF to create</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vv_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sentinel-1 RTC GeoTIFF, in power scale, with VV polarization</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>vh_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Sentinel-1 RTC GeoTIFF, in power scale, with VH polarization</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hand_raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Height Above Nearest Drainage (HAND) GeoTIFF aligned to the RTC rasters</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_shape</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape (height, width) in pixels to tile the image to</p>
              </div>
            </td>
            <td>
                  <code>(100, 100)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_vv_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum threshold value to use for <code>vv_raster</code> in decibels (db)</p>
              </div>
            </td>
            <td>
                  <code>-15.5</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>max_vh_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Maximum threshold value to use for <code>vh_raster</code> in decibels (db)</p>
              </div>
            </td>
            <td>
                  <code>-23.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hand_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The maximum height above nearest drainage in meters to consider
a pixel valid</p>
              </div>
            </td>
            <td>
                  <code>15.0</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>hand_fraction</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum fraction of valid HAND pixels required in a tile for
thresholding</p>
              </div>
            </td>
            <td>
                  <code>0.8</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>membership_threshold</code>
            </td>
            <td>
                  <code><span title="float">float</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The average membership to the fuzzy indicators required for a water pixel</p>
              </div>
            </td>
            <td>
                  <code>0.45</code>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/hydrosar/water_map.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">make_water_map</span><span class="p">(</span>
    <span class="n">out_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">vv_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">vh_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">hand_raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">tile_shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">100</span><span class="p">,</span> <span class="mi">100</span><span class="p">),</span>
    <span class="n">max_vv_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">15.5</span><span class="p">,</span>
    <span class="n">max_vh_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="o">-</span><span class="mf">23.0</span><span class="p">,</span>
    <span class="n">hand_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">15.0</span><span class="p">,</span>
    <span class="n">hand_fraction</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.8</span><span class="p">,</span>
    <span class="n">membership_threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.45</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a surface water extent map from a Sentinel-1 RTC product</span>

<span class="sd">    Create a surface water extent map from a dual-pol Sentinel-1 RTC product and</span>
<span class="sd">    a HAND image. The HAND image must be pixel-aligned (same extent and size) to</span>
<span class="sd">    the RTC images. The water extent maps are created using an adaptive Expectation</span>
<span class="sd">    Maximization thresholding approach and refined with Fuzzy Logic.</span>

<span class="sd">    The input images are broken into a set of corresponding tiles with a shape of</span>
<span class="sd">    `tile_shape`, and a set of tiles are selected from the VH RTC</span>
<span class="sd">    image that contain water boundaries to determine an appropriate water threshold.</span>
<span class="sd">     Candidate tiles must meet these criteria:</span>
<span class="sd">    * `hand_fraction` of pixels within a tile must have HAND pixel values lower</span>
<span class="sd">      than `hand_threshold`</span>
<span class="sd">    * The median backscatter value for the tile must be lower than an average tiles&#39;</span>
<span class="sd">      backscatter values</span>
<span class="sd">    * The tile must have a high variance -- high variance is considered initially to</span>
<span class="sd">      be a variance in the 95th percentile of the tile variances, but progressively</span>
<span class="sd">      relaxed to the 5th percentile if there not at least 5 candidate tiles.</span>

<span class="sd">    The 5 VH tiles with the highest variance are selected for thresholding and a</span>
<span class="sd">    water threshold value is determined using an Expectation Maximization approach.</span>
<span class="sd">    If there were not enough candidate tiles or the threshold is too high,</span>
<span class="sd">    `max_vh_threshold` and/or `max_vv_threshold` will be used instead.</span>

<span class="sd">    From the initial threshold-based water extent maps, Fuzzy Logic is used to remove</span>
<span class="sd">    spurious false detections and improve the water extent map quality. The fuzzy logic</span>
<span class="sd">    uses these indicators for the presence of water:</span>
<span class="sd">    * radar cross section in a pixel relative to the determined detection threshold</span>
<span class="sd">    * the height above nearest drainage (HAND)</span>
<span class="sd">    * the surface slope, which is derived from the HAND data</span>
<span class="sd">    * the size of the detected water feature</span>

<span class="sd">    For each indicator, a Z-shaped activation function is used to determine pixel membership.</span>
<span class="sd">    The membership maps are combined to form the final water extent map. Pixels classified</span>
<span class="sd">    as water pixels will:</span>
<span class="sd">    * have non-zero membership in all of the indicators, and</span>
<span class="sd">    * have an average membership above the `membership_threshold` value.</span>

<span class="sd">    Finally, the VV and VH water masks will be combined to include all water pixels</span>
<span class="sd">    from both masks, and the combined water map will be written to `out_raster`.</span>

<span class="sd">    Args:</span>
<span class="sd">        out_raster: Water map GeoTIFF to create</span>
<span class="sd">        vv_raster: Sentinel-1 RTC GeoTIFF, in power scale, with VV polarization</span>
<span class="sd">        vh_raster: Sentinel-1 RTC GeoTIFF, in power scale, with VH polarization</span>
<span class="sd">        hand_raster: Height Above Nearest Drainage (HAND) GeoTIFF aligned to the RTC rasters</span>
<span class="sd">        tile_shape: shape (height, width) in pixels to tile the image to</span>
<span class="sd">        max_vv_threshold: Maximum threshold value to use for `vv_raster` in decibels (db)</span>
<span class="sd">        max_vh_threshold:  Maximum threshold value to use for `vh_raster` in decibels (db)</span>
<span class="sd">        hand_threshold: The maximum height above nearest drainage in meters to consider</span>
<span class="sd">            a pixel valid</span>
<span class="sd">        hand_fraction: The minimum fraction of valid HAND pixels required in a tile for</span>
<span class="sd">            thresholding</span>
<span class="sd">        membership_threshold: The average membership to the fuzzy indicators required for a water pixel</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">tile_shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span> <span class="ow">or</span> <span class="n">tile_shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">%</span> <span class="mi">2</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;tile_shape </span><span class="si">{</span><span class="n">tile_shape</span><span class="si">}</span><span class="s1"> requires even values.&#39;</span><span class="p">)</span>

    <span class="n">info</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Info</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">vh_raster</span><span class="p">),</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;json&#39;</span><span class="p">)</span>

    <span class="n">out_transform</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;geoTransform&#39;</span><span class="p">]</span>
    <span class="n">out_epsg</span> <span class="o">=</span> <span class="n">get_epsg_code</span><span class="p">(</span><span class="n">info</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">hand_raster</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">hand_raster</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">out_raster</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;_HAND.tif&#39;</span><span class="p">)</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Extracting HAND data to: </span><span class="si">{</span><span class="n">hand_raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">prepare_hand_for_raster</span><span class="p">(</span><span class="n">hand_raster</span><span class="p">,</span> <span class="n">vh_raster</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Determining HAND memberships from </span><span class="si">{</span><span class="n">hand_raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">hand_array</span> <span class="o">=</span> <span class="n">read_as_masked_array</span><span class="p">(</span><span class="n">hand_raster</span><span class="p">)</span>
    <span class="n">hand_tiles</span> <span class="o">=</span> <span class="n">tile_array</span><span class="p">(</span><span class="n">hand_array</span><span class="p">,</span> <span class="n">tile_shape</span><span class="o">=</span><span class="n">tile_shape</span><span class="p">,</span> <span class="n">pad_value</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="n">hand_candidates</span> <span class="o">=</span> <span class="n">select_hand_tiles</span><span class="p">(</span><span class="n">hand_tiles</span><span class="p">,</span> <span class="n">hand_threshold</span><span class="p">,</span> <span class="n">hand_fraction</span><span class="p">)</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Selected HAND tile candidates </span><span class="si">{</span><span class="n">hand_candidates</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="n">selected_tiles</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">nodata</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">iinfo</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">uint8</span><span class="p">)</span><span class="o">.</span><span class="n">max</span>
    <span class="n">water_extent_maps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">max_db_threshold</span><span class="p">,</span> <span class="n">raster</span><span class="p">,</span> <span class="n">pol</span> <span class="ow">in</span> <span class="p">(</span>
        <span class="p">(</span><span class="n">max_vh_threshold</span><span class="p">,</span> <span class="n">vh_raster</span><span class="p">,</span> <span class="s1">&#39;VH&#39;</span><span class="p">),</span>
        <span class="p">(</span><span class="n">max_vv_threshold</span><span class="p">,</span> <span class="n">vv_raster</span><span class="p">,</span> <span class="s1">&#39;VV&#39;</span><span class="p">),</span>
    <span class="p">):</span>
        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Creating initial </span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s1"> water extent map from </span><span class="si">{</span><span class="n">raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">read_as_masked_array</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
        <span class="n">padding_mask</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">tile_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">tile_shape</span><span class="o">=</span><span class="n">tile_shape</span><span class="p">,</span> <span class="n">pad_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="c1"># Masking less than zero only necessary for old HyP3/GAMMA products which sometimes returned negative powers</span>
        <span class="n">tiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">selected_tiles</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">selected_tiles</span> <span class="o">=</span> <span class="n">select_backscatter_tiles</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">hand_candidates</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Selected tiles </span><span class="si">{</span><span class="n">selected_tiles</span><span class="si">}</span><span class="s1"> from </span><span class="si">{</span><span class="n">raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">testing</span><span class="o">.</span><span class="n">suppress_warnings</span><span class="p">()</span> <span class="k">as</span> <span class="n">sup</span><span class="p">:</span>
            <span class="n">sup</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="ne">RuntimeWarning</span><span class="p">)</span>  <span class="c1"># invalid value and divide by zero encountered in log10</span>
            <span class="n">tiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">tiles</span><span class="p">)</span> <span class="o">+</span> <span class="mf">30.0</span>  <span class="c1"># linear power scale -&gt; Gaussian scale optimized for thresholding</span>
        <span class="n">max_gaussian_threshold</span> <span class="o">=</span> <span class="n">max_db_threshold</span> <span class="o">/</span> <span class="mf">10.0</span> <span class="o">+</span> <span class="mf">30.0</span>  <span class="c1"># db -&gt; Gaussian scale optimized for thresholding</span>
        <span class="k">if</span> <span class="n">selected_tiles</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
            <span class="n">scaling</span> <span class="o">=</span> <span class="mi">256</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">tiles</span><span class="p">)</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">tiles</span><span class="p">))</span>
            <span class="n">gaussian_threshold</span> <span class="o">=</span> <span class="n">determine_em_threshold</span><span class="p">(</span><span class="n">tiles</span><span class="p">[</span><span class="n">selected_tiles</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:],</span> <span class="n">scaling</span><span class="p">)</span>
            <span class="n">threshold_db</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="o">*</span> <span class="p">(</span><span class="n">gaussian_threshold</span> <span class="o">-</span> <span class="mf">30.0</span><span class="p">)</span>
            <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Threshold determined to be </span><span class="si">{</span><span class="n">threshold_db</span><span class="si">}</span><span class="s1"> db&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">gaussian_threshold</span> <span class="o">&gt;</span> <span class="n">max_gaussian_threshold</span><span class="p">:</span>
                <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Threshold too high! Using maximum threshold </span><span class="si">{</span><span class="n">max_db_threshold</span><span class="si">}</span><span class="s1"> db&#39;</span><span class="p">)</span>
                <span class="n">gaussian_threshold</span> <span class="o">=</span> <span class="n">max_gaussian_threshold</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">log</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Tile selection did not converge! using default threshold </span><span class="si">{</span><span class="n">max_db_threshold</span><span class="si">}</span><span class="s1"> db&#39;</span><span class="p">)</span>
            <span class="n">gaussian_threshold</span> <span class="o">=</span> <span class="n">max_gaussian_threshold</span>

        <span class="n">gaussian_array</span> <span class="o">=</span> <span class="n">untile_array</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">water_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_less_equal</span><span class="p">(</span><span class="n">gaussian_array</span><span class="p">,</span> <span class="n">gaussian_threshold</span><span class="p">)</span><span class="o">.</span><span class="n">mask</span>
        <span class="n">water_map</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">array</span><span class="o">.</span><span class="n">mask</span>

        <span class="n">write_cog</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">out_raster</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s1">_initial.tif&#39;</span><span class="p">),</span>
            <span class="n">format_raster_data</span><span class="p">(</span><span class="n">water_map</span><span class="p">,</span> <span class="n">padding_mask</span><span class="p">,</span> <span class="n">nodata</span><span class="p">),</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">out_transform</span><span class="p">,</span>
            <span class="n">epsg_code</span><span class="o">=</span><span class="n">out_epsg</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
            <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Refining initial </span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s1"> water extent map using Fuzzy Logic&#39;</span><span class="p">)</span>
        <span class="n">array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_where</span><span class="p">(</span><span class="o">~</span><span class="n">water_map</span><span class="p">,</span> <span class="n">array</span><span class="p">)</span>
        <span class="n">gaussian_lower_limit</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">median</span><span class="p">(</span><span class="n">array</span><span class="p">))</span> <span class="o">+</span> <span class="mf">30.0</span>

        <span class="n">water_map</span> <span class="o">=</span> <span class="n">fuzzy_refinement</span><span class="p">(</span>
            <span class="n">water_map</span><span class="p">,</span>
            <span class="n">gaussian_array</span><span class="p">,</span>
            <span class="n">hand_array</span><span class="p">,</span>
            <span class="n">pixel_size</span><span class="o">=</span><span class="n">out_transform</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="n">gaussian_thresholds</span><span class="o">=</span><span class="p">(</span><span class="n">gaussian_lower_limit</span><span class="p">,</span> <span class="n">gaussian_threshold</span><span class="p">),</span>
            <span class="n">membership_threshold</span><span class="o">=</span><span class="n">membership_threshold</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">water_map</span> <span class="o">&amp;=</span> <span class="o">~</span><span class="n">array</span><span class="o">.</span><span class="n">mask</span>

        <span class="n">write_cog</span><span class="p">(</span>
            <span class="nb">str</span><span class="p">(</span><span class="n">out_raster</span><span class="p">)</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">,</span> <span class="sa">f</span><span class="s1">&#39;_</span><span class="si">{</span><span class="n">pol</span><span class="si">}</span><span class="s1">_fuzzy.tif&#39;</span><span class="p">),</span>
            <span class="n">format_raster_data</span><span class="p">(</span><span class="n">water_map</span><span class="p">,</span> <span class="n">padding_mask</span><span class="p">,</span> <span class="n">nodata</span><span class="p">),</span>
            <span class="n">transform</span><span class="o">=</span><span class="n">out_transform</span><span class="p">,</span>
            <span class="n">epsg_code</span><span class="o">=</span><span class="n">out_epsg</span><span class="p">,</span>
            <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
            <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
        <span class="p">)</span>

        <span class="n">water_extent_maps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">water_map</span><span class="p">)</span>

    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s1">&#39;Combining Fuzzy VH and VV extent map&#39;</span><span class="p">)</span>
    <span class="n">combined_water_map</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_or</span><span class="p">(</span><span class="o">*</span><span class="n">water_extent_maps</span><span class="p">)</span>

    <span class="n">combined_segments</span> <span class="o">=</span> <span class="n">measure</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">combined_water_map</span><span class="p">,</span> <span class="n">connectivity</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
    <span class="n">combined_water_map</span> <span class="o">=</span> <span class="n">remove_small_segments</span><span class="p">(</span><span class="n">combined_segments</span><span class="p">)</span>

    <span class="n">write_cog</span><span class="p">(</span>
        <span class="n">out_raster</span><span class="p">,</span>
        <span class="n">format_raster_data</span><span class="p">(</span><span class="n">combined_water_map</span><span class="p">,</span> <span class="n">padding_mask</span><span class="p">,</span> <span class="n">nodata</span><span class="p">),</span>
        <span class="n">transform</span><span class="o">=</span><span class="n">out_transform</span><span class="p">,</span>
        <span class="n">epsg_code</span><span class="o">=</span><span class="n">out_epsg</span><span class="p">,</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
        <span class="n">nodata_value</span><span class="o">=</span><span class="n">nodata</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="asf_tools.raster" class="doc doc-heading">
            <code>raster</code>


<a href="#asf_tools.raster" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="asf_tools.raster.convert_scale" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">convert_scale</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">in_scale</span><span class="p">,</span> <span class="n">out_scale</span><span class="p">)</span></code>

<a href="#asf_tools.raster.convert_scale" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Convert calibrated raster scale between db, amplitude and power</p>


            <details class="quote">
              <summary>Source code in <code>asf_tools/raster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">convert_scale</span><span class="p">(</span>
    <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">,</span>
    <span class="n">in_scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">],</span>
    <span class="n">out_scale</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s1">&#39;db&#39;</span><span class="p">,</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">,</span> <span class="s1">&#39;power&#39;</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert calibrated raster scale between db, amplitude and power&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">in_scale</span> <span class="o">==</span> <span class="n">out_scale</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Nothing to do! </span><span class="si">{</span><span class="n">in_scale</span><span class="si">}</span><span class="s1"> is same as </span><span class="si">{</span><span class="n">out_scale</span><span class="si">}</span><span class="s1">.&#39;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">array</span>

    <span class="n">log10</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">log10</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span>

    <span class="k">if</span> <span class="n">in_scale</span> <span class="o">==</span> <span class="s1">&#39;db&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">out_scale</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">array</span> <span class="o">/</span> <span class="mi">10</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_scale</span> <span class="o">==</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">10</span> <span class="o">**</span> <span class="p">(</span><span class="n">array</span> <span class="o">/</span> <span class="mi">20</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">in_scale</span> <span class="o">==</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">out_scale</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">array</span><span class="o">**</span><span class="mi">2</span>
        <span class="k">if</span> <span class="n">out_scale</span> <span class="o">==</span> <span class="s1">&#39;db&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">array</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">in_scale</span> <span class="o">==</span> <span class="s1">&#39;power&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">out_scale</span> <span class="o">==</span> <span class="s1">&#39;amplitude&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">out_scale</span> <span class="o">==</span> <span class="s1">&#39;db&#39;</span><span class="p">:</span>
            <span class="k">return</span> <span class="mi">10</span> <span class="o">*</span> <span class="n">log10</span><span class="p">(</span><span class="n">array</span><span class="p">)</span>

    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot convert raster of scale </span><span class="si">{</span><span class="n">in_scale</span><span class="si">}</span><span class="s1"> to </span><span class="si">{</span><span class="n">out_scale</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.raster.read_as_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_as_array</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#asf_tools.raster.read_as_array" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reads data from a raster image into memory</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raster</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to a raster image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>band</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raster band to read</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>data</code></td>            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raster pixel data as a numpy array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/raster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_as_array</span><span class="p">(</span><span class="n">raster</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">band</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads data from a raster image into memory</span>

<span class="sd">    Args:</span>
<span class="sd">        raster: The file path to a raster image</span>
<span class="sd">        band: The raster band to read</span>

<span class="sd">    Returns:</span>
<span class="sd">        data: The raster pixel data as a numpy array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading raster values from </span><span class="si">{</span><span class="n">raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">raster</span><span class="p">)</span>
    <span class="n">data</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">band</span><span class="p">)</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>
    <span class="k">del</span> <span class="n">ds</span>  <span class="c1"># How to close w/ gdal</span>
    <span class="k">return</span> <span class="n">data</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.raster.read_as_masked_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">read_as_masked_array</span><span class="p">(</span><span class="n">raster</span><span class="p">,</span> <span class="n">band</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

<a href="#asf_tools.raster.read_as_masked_array" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Reads data from a raster image into memory, masking invalid and NoData values</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>raster</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The file path to a raster image</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>band</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raster band to read</p>
              </div>
            </td>
            <td>
                  <code>1</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>raster_array</code></td>            <td>
                  <code><span title="numpy.ma.MaskedArray">MaskedArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raster pixel data as a numpy MaskedArray</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/raster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">read_as_masked_array</span><span class="p">(</span><span class="n">raster</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span> <span class="n">band</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Reads data from a raster image into memory, masking invalid and NoData values</span>

<span class="sd">    Args:</span>
<span class="sd">        raster: The file path to a raster image</span>
<span class="sd">        band: The raster band to read</span>

<span class="sd">    Returns:</span>
<span class="sd">        raster_array: The raster pixel data as a numpy MaskedArray</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Reading raster values from </span><span class="si">{</span><span class="n">raster</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="n">ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">raster</span><span class="p">))</span>
    <span class="n">raster_band</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="n">band</span><span class="p">)</span>
    <span class="n">raster_array</span> <span class="o">=</span> <span class="n">raster_band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

    <span class="n">nodata</span> <span class="o">=</span> <span class="n">raster_band</span><span class="o">.</span><span class="n">GetNoDataValue</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">nodata</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">raster_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_values</span><span class="p">(</span><span class="n">raster_array</span><span class="p">,</span> <span class="n">nodata</span><span class="p">)</span>
    <span class="n">raster_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">masked_invalid</span><span class="p">(</span><span class="n">raster_array</span><span class="p">)</span>

    <span class="k">del</span> <span class="n">ds</span>  <span class="c1"># How to close w/ gdal</span>
    <span class="k">return</span> <span class="n">raster_array</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.raster.write_cog" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">write_cog</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">transform</span><span class="p">,</span> <span class="n">epsg_code</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">,</span> <span class="n">nodata_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#asf_tools.raster.write_cog" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Creates a Cloud Optimized GeoTIFF</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>file_name</code>
            </td>
            <td>
                  <code><span title="str">str</span> | <span title="pathlib.Path">Path</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output file name</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>data</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The raster data</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>transform</code>
            </td>
            <td>
                  <code><span title="list">list</span>[<span title="float">float</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The geotransform for the output GeoTIFF</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>epsg_code</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The integer EPSG code for the output GeoTIFF projection</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>dtype</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The pixel data type for the output GeoTIFF</p>
              </div>
            </td>
            <td>
                  <code><span title="osgeo.gdal.GDT_Float32">GDT_Float32</span></code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>nodata_value</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The NODATA value for the output Geotiff</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>file_name</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The output file name</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/raster.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">write_cog</span><span class="p">(</span>
    <span class="n">file_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="n">Path</span><span class="p">,</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span>
    <span class="n">transform</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">float</span><span class="p">],</span>
    <span class="n">epsg_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">dtype</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Float32</span><span class="p">,</span>
    <span class="n">nodata_value</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Creates a Cloud Optimized GeoTIFF</span>

<span class="sd">    Args:</span>
<span class="sd">        file_name: The output file name</span>
<span class="sd">        data: The raster data</span>
<span class="sd">        transform: The geotransform for the output GeoTIFF</span>
<span class="sd">        epsg_code: The integer EPSG code for the output GeoTIFF projection</span>
<span class="sd">        dtype: The pixel data type for the output GeoTIFF</span>
<span class="sd">        nodata_value: The NODATA value for the output Geotiff</span>

<span class="sd">    Returns:</span>
<span class="sd">        file_name: The output file name</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Creating </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">NamedTemporaryFile</span><span class="p">()</span> <span class="k">as</span> <span class="n">temp_file</span><span class="p">:</span>
        <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>
        <span class="n">temp_geotiff</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span><span class="n">temp_file</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">data</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="mi">1</span><span class="p">,</span> <span class="n">dtype</span><span class="p">)</span>
        <span class="n">temp_geotiff</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">nodata_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">temp_geotiff</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">SetNoDataValue</span><span class="p">(</span><span class="n">nodata_value</span><span class="p">)</span>
        <span class="n">temp_geotiff</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">transform</span><span class="p">)</span>
        <span class="n">temp_geotiff</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">epsg_to_wkt</span><span class="p">(</span><span class="n">epsg_code</span><span class="p">))</span>

        <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;COG&#39;</span><span class="p">)</span>
        <span class="n">options</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;COMPRESS=LZW&#39;</span><span class="p">,</span>
            <span class="s1">&#39;OVERVIEW_RESAMPLING=AVERAGE&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NUM_THREADS=ALL_CPUS&#39;</span><span class="p">,</span>
            <span class="s1">&#39;BIGTIFF=YES&#39;</span><span class="p">,</span>
        <span class="p">]</span>
        <span class="n">driver</span><span class="o">.</span><span class="n">CreateCopy</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">file_name</span><span class="p">),</span> <span class="n">temp_geotiff</span><span class="p">,</span> <span class="n">options</span><span class="o">=</span><span class="n">options</span><span class="p">)</span>

        <span class="k">del</span> <span class="n">temp_geotiff</span>  <span class="c1"># How to close w/ gdal</span>
    <span class="k">return</span> <span class="n">file_name</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="asf_tools.tile" class="doc doc-heading">
            <code>tile</code>


<a href="#asf_tools.tile" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h3 id="asf_tools.tile.tile_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tile_array</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">tile_shape</span><span class="o">=</span><span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span> <span class="n">pad_value</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

<a href="#asf_tools.tile.tile_array" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Tile a 2D numpy array</p>


<details class="turn-a-2d-numpy-array-like" open>
  <summary>Turn a 2D numpy array like</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>array = [[0, 0, 1, 1],
...          [0, 0, 1, 1],
...          [2, 2, 3, 3],
...          [2, 2, 3, 3]]
array.shape
(4, 4)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<details class="into-a-tiled-array-like" open>
  <summary>into a tiled array like</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>tiles = tiled_array(array, 2, 2)
print(tiles)
[[[0, 0],
  [0, 0]],
 [[1, 1],
  [1, 1]],
 [[2, 2],
  [2, 2]],
 [[3, 3],
  [3, 3]]]
tiles.shape
(4, 2, 2)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>array</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="numpy.ma.MaskedArray">MaskedArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>2D array to tile</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_shape</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the shape of each tile</p>
              </div>
            </td>
            <td>
                  <code>(200, 200)</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>pad_value</code>
            </td>
            <td>
                  <code><span title="float">float</span> | None</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>right-bottom pad <code>a</code> with <code>pad</code> as needed so <code>a</code> is evenly divisible into tiles</p>
              </div>
            </td>
            <td>
                  <code>None</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="numpy.ma.MaskedArray">MaskedArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the tiled array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/tile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 4</span>
<span class="normal"> 5</span>
<span class="normal"> 6</span>
<span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tile_array</span><span class="p">(</span>
    <span class="n">array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">,</span>
    <span class="n">tile_shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="mi">200</span><span class="p">,</span> <span class="mi">200</span><span class="p">),</span>
    <span class="n">pad_value</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Tile a 2D numpy array</span>

<span class="sd">    Turn a 2D numpy array like:</span>
<span class="sd">        &gt;&gt;&gt; array = [[0, 0, 1, 1],</span>
<span class="sd">        ...          [0, 0, 1, 1],</span>
<span class="sd">        ...          [2, 2, 3, 3],</span>
<span class="sd">        ...          [2, 2, 3, 3]]</span>
<span class="sd">        &gt;&gt;&gt; array.shape</span>
<span class="sd">        (4, 4)</span>

<span class="sd">    into a tiled array like:</span>
<span class="sd">        &gt;&gt;&gt; tiles = tiled_array(array, 2, 2)</span>
<span class="sd">        &gt;&gt;&gt; print(tiles)</span>
<span class="sd">        [[[0, 0],</span>
<span class="sd">          [0, 0]],</span>
<span class="sd">         [[1, 1],</span>
<span class="sd">          [1, 1]],</span>
<span class="sd">         [[2, 2],</span>
<span class="sd">          [2, 2]],</span>
<span class="sd">         [[3, 3],</span>
<span class="sd">          [3, 3]]]</span>
<span class="sd">        &gt;&gt;&gt; tiles.shape</span>
<span class="sd">        (4, 2, 2)</span>

<span class="sd">    Args:</span>
<span class="sd">        array: 2D array to tile</span>
<span class="sd">        tile_shape: the shape of each tile</span>
<span class="sd">        pad_value: right-bottom pad `a` with `pad` as needed so `a` is evenly divisible into tiles</span>

<span class="sd">    Returns:</span>
<span class="sd">        the tiled array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">array_rows</span><span class="p">,</span> <span class="n">array_columns</span> <span class="o">=</span> <span class="n">array</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">tile_rows</span><span class="p">,</span> <span class="n">tile_columns</span> <span class="o">=</span> <span class="n">tile_shape</span>

    <span class="c1"># CREDIT: https://twitter.com/LizzUltee/status/1379508448262512641</span>
    <span class="n">rpad</span> <span class="o">=</span> <span class="o">-</span><span class="n">array_rows</span> <span class="o">%</span> <span class="n">tile_rows</span>
    <span class="n">cpad</span> <span class="o">=</span> <span class="o">-</span><span class="n">array_columns</span> <span class="o">%</span> <span class="n">tile_columns</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">rpad</span> <span class="ow">or</span> <span class="n">cpad</span><span class="p">)</span> <span class="ow">and</span> <span class="n">pad_value</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Cannot evenly tile a </span><span class="si">{</span><span class="n">array</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s1"> array into (</span><span class="si">{</span><span class="n">tile_rows</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">tile_columns</span><span class="si">}</span><span class="s1">) tiles&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rpad</span> <span class="ow">or</span> <span class="n">cpad</span><span class="p">:</span>
        <span class="k">assert</span> <span class="n">pad_value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
        <span class="n">padded_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">rpad</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cpad</span><span class="p">)),</span> <span class="n">constant_values</span><span class="o">=</span><span class="n">pad_value</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">array</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="p">((</span><span class="mi">0</span><span class="p">,</span> <span class="n">rpad</span><span class="p">),</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">cpad</span><span class="p">)),</span> <span class="n">constant_values</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">padded_array</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">padded_array</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">mask</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">padded_array</span> <span class="o">=</span> <span class="n">array</span>

    <span class="n">tile_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">rows</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">vsplit</span><span class="p">(</span><span class="n">padded_array</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">tile_rows</span><span class="p">,</span> <span class="n">array_rows</span><span class="p">,</span> <span class="n">tile_rows</span><span class="p">)):</span>
        <span class="n">tile_list</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">hsplit</span><span class="p">(</span><span class="n">rows</span><span class="p">,</span> <span class="nb">range</span><span class="p">(</span><span class="n">tile_columns</span><span class="p">,</span> <span class="n">array_columns</span><span class="p">,</span> <span class="n">tile_columns</span><span class="p">)))</span>

    <span class="n">dstack</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">dstack</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">)</span> <span class="k">else</span> <span class="n">np</span><span class="o">.</span><span class="n">dstack</span>
    <span class="n">tiled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">moveaxis</span><span class="p">(</span><span class="n">dstack</span><span class="p">(</span><span class="n">tile_list</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">tiled</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.tile.untile_array" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">untile_array</span><span class="p">(</span><span class="n">tiled_array</span><span class="p">,</span> <span class="n">array_shape</span><span class="p">)</span></code>

<a href="#asf_tools.tile.untile_array" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Untile a tiled array into a 2D numpy array</p>
<p>This is the reverse of <code>tile_array</code> and will turn a tiled array like:
    &gt;&gt;&gt; tiled_array = [[[0,0],
    ...                 [0,0]],
    ...                [[1,1],
    ...                 [1,1]],
    ...                [[2,2],
    ...                 [2,2]],
    ...                [[3,3],
    ...                 [3,3]]]
    &gt;&gt;&gt; tiled_array.shape
    (4, 2, 2)</p>


<details class="into-a-2d-array-like" open>
  <summary>into a 2D array like</summary>
  <blockquote>
<blockquote>
<blockquote>
<p>array = untile_array(tiled_array)
print(array)
[[0, 0, 1, 1],
 [0, 0, 1, 1],
 [2, 2, 3, 3],
 [2, 2, 3, 3]]
array.shape
(4, 4)</p>
</blockquote>
</blockquote>
</blockquote>
</details>

<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tiled_array</code>
            </td>
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="numpy.ma.MaskedArray">MaskedArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>a tiled array</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>array_shape</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span>[<span title="int">int</span>, <span title="int">int</span>]</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>shape to untile the array to. If array_shape's size is smaller
than the tiled array, <code>untile_array</code> will subset the tiled array assuming
bottom right padding was added when tiling.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code><span title="numpy.ndarray">ndarray</span> | <span title="numpy.ma.MaskedArray">MaskedArray</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the untiled array</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/tile.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">untile_array</span><span class="p">(</span>
    <span class="n">tiled_array</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">,</span> <span class="n">array_shape</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Untile a tiled array into a 2D numpy array</span>

<span class="sd">    This is the reverse of `tile_array` and will turn a tiled array like:</span>
<span class="sd">        &gt;&gt;&gt; tiled_array = [[[0,0],</span>
<span class="sd">        ...                 [0,0]],</span>
<span class="sd">        ...                [[1,1],</span>
<span class="sd">        ...                 [1,1]],</span>
<span class="sd">        ...                [[2,2],</span>
<span class="sd">        ...                 [2,2]],</span>
<span class="sd">        ...                [[3,3],</span>
<span class="sd">        ...                 [3,3]]]</span>
<span class="sd">        &gt;&gt;&gt; tiled_array.shape</span>
<span class="sd">        (4, 2, 2)</span>

<span class="sd">    into a 2D array like:</span>
<span class="sd">        &gt;&gt;&gt; array = untile_array(tiled_array)</span>
<span class="sd">        &gt;&gt;&gt; print(array)</span>
<span class="sd">        [[0, 0, 1, 1],</span>
<span class="sd">         [0, 0, 1, 1],</span>
<span class="sd">         [2, 2, 3, 3],</span>
<span class="sd">         [2, 2, 3, 3]]</span>
<span class="sd">        &gt;&gt;&gt; array.shape</span>
<span class="sd">        (4, 4)</span>

<span class="sd">    Args:</span>
<span class="sd">        tiled_array: a tiled array</span>
<span class="sd">        array_shape: shape to untile the array to. If array_shape&#39;s size is smaller</span>
<span class="sd">            than the tiled array, `untile_array` will subset the tiled array assuming</span>
<span class="sd">            bottom right padding was added when tiling.</span>

<span class="sd">    Returns:</span>
<span class="sd">        the untiled array</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">_</span><span class="p">,</span> <span class="n">tile_rows</span><span class="p">,</span> <span class="n">tile_columns</span> <span class="o">=</span> <span class="n">tiled_array</span><span class="o">.</span><span class="n">shape</span>
    <span class="n">array_rows</span><span class="p">,</span> <span class="n">array_columns</span> <span class="o">=</span> <span class="n">array_shape</span>

    <span class="n">untiled_rows</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">array_rows</span> <span class="o">/</span> <span class="n">tile_rows</span><span class="p">))</span>
    <span class="n">untiled_columns</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">array_columns</span> <span class="o">/</span> <span class="n">tile_columns</span><span class="p">))</span>

    <span class="n">untiled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span>
        <span class="p">(</span><span class="n">untiled_rows</span> <span class="o">*</span> <span class="n">tile_rows</span><span class="p">,</span> <span class="n">untiled_columns</span> <span class="o">*</span> <span class="n">tile_columns</span><span class="p">),</span>
        <span class="n">dtype</span><span class="o">=</span><span class="n">tiled_array</span><span class="o">.</span><span class="n">dtype</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">array_size</span> <span class="o">:=</span> <span class="n">array_rows</span> <span class="o">*</span> <span class="n">array_columns</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">tiled_array</span><span class="o">.</span><span class="n">size</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="sa">f</span><span class="s1">&#39;array_shape </span><span class="si">{</span><span class="n">array_shape</span><span class="si">}</span><span class="s1"> will result in an array bigger than the tiled array:&#39;</span>
            <span class="sa">f</span><span class="s1">&#39; </span><span class="si">{</span><span class="n">array_size</span><span class="si">}</span><span class="s1"> &gt; </span><span class="si">{</span><span class="n">tiled_array</span><span class="o">.</span><span class="n">size</span><span class="si">}</span><span class="s1">&#39;</span>
        <span class="p">)</span>

    <span class="k">for</span> <span class="n">ii</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">untiled_rows</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">jj</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">untiled_columns</span><span class="p">):</span>
            <span class="n">untiled</span><span class="p">[</span>
                <span class="n">ii</span> <span class="o">*</span> <span class="n">tile_rows</span> <span class="p">:</span> <span class="p">(</span><span class="n">ii</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tile_rows</span><span class="p">,</span>
                <span class="n">jj</span> <span class="o">*</span> <span class="n">tile_columns</span> <span class="p">:</span> <span class="p">(</span><span class="n">jj</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">*</span> <span class="n">tile_columns</span><span class="p">,</span>
            <span class="p">]</span> <span class="o">=</span> <span class="n">tiled_array</span><span class="p">[</span><span class="n">ii</span> <span class="o">*</span> <span class="n">untiled_columns</span> <span class="o">+</span> <span class="n">jj</span><span class="p">,</span> <span class="p">:,</span> <span class="p">:]</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">tiled_array</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">):</span>
        <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">untiled</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span>
        <span class="n">untiled_mask</span> <span class="o">=</span> <span class="n">untile_array</span><span class="p">(</span><span class="n">tiled_array</span><span class="o">.</span><span class="n">mask</span><span class="p">,</span> <span class="n">untiled</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>  <span class="c1"># type: ignore[arg-type]</span>
        <span class="n">untiled</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">MaskedArray</span><span class="p">(</span><span class="n">untiled</span><span class="p">,</span> <span class="n">mask</span><span class="o">=</span><span class="n">untiled_mask</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">untiled</span><span class="p">[:</span><span class="n">array_rows</span><span class="p">,</span> <span class="p">:</span><span class="n">array_columns</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="asf_tools.util" class="doc doc-heading">
            <code>util</code>


<a href="#asf_tools.util" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h3 id="asf_tools.util.GDALConfigManager" class="doc doc-heading">
            <code>GDALConfigManager</code>


<a href="#asf_tools.util.GDALConfigManager" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">


        <p>Context manager for setting GDAL config options temporarily</p>







              <details class="quote">
                <summary>Source code in <code>asf_tools/util.py</code></summary>
                <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span><span class="w"> </span><span class="nc">GDALConfigManager</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Context manager for setting GDAL config options temporarily&quot;&quot;&quot;</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Args:</span>
<span class="sd">        **options: GDAL Config `option=value` keyword arguments.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_previous_options</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_previous_options</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetConfigOption</span><span class="p">(</span><span class="n">key</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">SetConfigOption</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>

    <span class="k">def</span><span class="w"> </span><span class="fm">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">exc_type</span><span class="p">,</span> <span class="n">exc_val</span><span class="p">,</span> <span class="n">exc_tb</span><span class="p">):</span>
        <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_previous_options</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">SetConfigOption</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
              </details>



  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.util.GDALConfigManager.__init__" class="doc doc-heading">
            <code class="highlight language-python"><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">options</span><span class="p">)</span></code>

<a href="#asf_tools.util.GDALConfigManager.__init__" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Args:
**options: GDAL Config <code>option=value</code> keyword arguments.</p>


            <details class="quote">
              <summary>Source code in <code>asf_tools/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">options</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Args:</span>
<span class="sd">    **options: GDAL Config `option=value` keyword arguments.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">options</span> <span class="o">=</span> <span class="n">options</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">_previous_options</span> <span class="o">=</span> <span class="p">{}</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


<div class="doc doc-object doc-function">


<h3 id="asf_tools.util.epsg_to_wkt" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">epsg_to_wkt</span><span class="p">(</span><span class="n">epsg_code</span><span class="p">)</span></code>

<a href="#asf_tools.util.epsg_to_wkt" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the WKT representation of a projection from its EPSG code</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>epsg_code</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The integer EPSG code</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>wkt</code></td>            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The WKT representation of the projection</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">epsg_to_wkt</span><span class="p">(</span><span class="n">epsg_code</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the WKT representation of a projection from its EPSG code</span>

<span class="sd">    Args:</span>
<span class="sd">        epsg_code: The integer EPSG code</span>

<span class="sd">    Returns:</span>
<span class="sd">        wkt: The WKT representation of the projection</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">srs</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">()</span>
    <span class="n">srs</span><span class="o">.</span><span class="n">ImportFromEPSG</span><span class="p">(</span><span class="n">epsg_code</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">srs</span><span class="o">.</span><span class="n">ExportToWkt</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.util.get_coordinates" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_coordinates</span><span class="p">(</span><span class="n">info</span><span class="p">)</span></code>

<a href="#asf_tools.util.get_coordinates" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the corner coordinates from a GDAL Info dictionary</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>info</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary returned by a gdal.Info call</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                  <code>(<span title="west">west</span>, <span title="south">south</span>, <span title="east">east</span>, <span title="north">north</span>)</code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>the corner coordinates values</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_coordinates</span><span class="p">(</span><span class="n">info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the corner coordinates from a GDAL Info dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        info: The dictionary returned by a gdal.Info call</span>

<span class="sd">    Returns:</span>
<span class="sd">        (west, south, east, north): the corner coordinates values</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">west</span><span class="p">,</span> <span class="n">south</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;lowerLeft&#39;</span><span class="p">]</span>
    <span class="n">east</span><span class="p">,</span> <span class="n">north</span> <span class="o">=</span> <span class="n">info</span><span class="p">[</span><span class="s1">&#39;cornerCoordinates&#39;</span><span class="p">][</span><span class="s1">&#39;upperRight&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">west</span><span class="p">,</span> <span class="n">south</span><span class="p">,</span> <span class="n">east</span><span class="p">,</span> <span class="n">north</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h3 id="asf_tools.util.get_epsg_code" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_epsg_code</span><span class="p">(</span><span class="n">info</span><span class="p">)</span></code>

<a href="#asf_tools.util.get_epsg_code" class="headerlink" title="Permanent link">&para;</a></h3>


    <div class="doc doc-contents ">

        <p>Get the EPSG code from a GDAL Info dictionary</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>info</code>
            </td>
            <td>
                  <code><span title="dict">dict</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The dictionary returned by a gdal.Info call</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>epsg_code</code></td>            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The integer EPSG code</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/util.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_epsg_code</span><span class="p">(</span><span class="n">info</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the EPSG code from a GDAL Info dictionary</span>

<span class="sd">    Args:</span>
<span class="sd">        info: The dictionary returned by a gdal.Info call</span>

<span class="sd">    Returns:</span>
<span class="sd">        epsg_code: The integer EPSG code</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">proj</span> <span class="o">=</span> <span class="n">osr</span><span class="o">.</span><span class="n">SpatialReference</span><span class="p">(</span><span class="n">info</span><span class="p">[</span><span class="s1">&#39;coordinateSystem&#39;</span><span class="p">][</span><span class="s1">&#39;wkt&#39;</span><span class="p">])</span>
    <span class="n">epsg_code</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">proj</span><span class="o">.</span><span class="n">GetAttrValue</span><span class="p">(</span><span class="s1">&#39;AUTHORITY&#39;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">epsg_code</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="asf_tools.watermasking" class="doc doc-heading">
            <code>watermasking</code>


<a href="#asf_tools.watermasking" class="headerlink" title="Permanent link">&para;</a></h2>

    <div class="doc doc-contents ">









  <div class="doc doc-children">










<div class="doc doc-object doc-module">



<h3 id="asf_tools.watermasking.generate_osm_tiles" class="doc doc-heading">
            <code>generate_osm_tiles</code>


<a href="#asf_tools.watermasking.generate_osm_tiles" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_osm_tiles.extract_water" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">extract_water</span><span class="p">(</span><span class="n">water_file</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tile_width_deg</span><span class="p">,</span> <span class="n">tile_height_deg</span><span class="p">,</span> <span class="n">interior_tile_dir</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_osm_tiles.extract_water" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Rasterize a water tile from the processed global PBF file.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>water_file</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the processed global PBF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum latitude of the tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum longitude of the tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_width_deg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired width of the tile in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_height_deg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired height of the tile in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_osm_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">extract_water</span><span class="p">(</span><span class="n">water_file</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tile_width_deg</span><span class="p">,</span> <span class="n">tile_height_deg</span><span class="p">,</span> <span class="n">interior_tile_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Rasterize a water tile from the processed global PBF file.</span>

<span class="sd">    Args:</span>
<span class="sd">        water_file: The path to the processed global PBF file.</span>
<span class="sd">        lat: The minimum latitude of the tile.</span>
<span class="sd">        lon: The minimum longitude of the tile.</span>
<span class="sd">        tile_width_deg: The desired width of the tile in degrees.</span>
<span class="sd">        tile_height_deg: The desired height of the tile in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">lat_lon_to_tile_string</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">is_worldcover</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">tile_pbf</span> <span class="o">=</span> <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.osm.pbf&#39;</span>
    <span class="n">tile_tif</span> <span class="o">=</span> <span class="n">interior_tile_dir</span> <span class="o">+</span> <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span>
    <span class="n">tile_shp</span> <span class="o">=</span> <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.shp&#39;</span>
    <span class="n">tile_geojson</span> <span class="o">=</span> <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.geojson&#39;</span>

    <span class="c1"># Extract tile from the main pbf, then convert it to a tif.</span>
    <span class="n">bbox</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;--bbox </span><span class="si">{</span><span class="n">lon</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">lat</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">lon</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tile_width_deg</span><span class="si">}</span><span class="s1">,</span><span class="si">{</span><span class="n">lat</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="n">tile_height_deg</span><span class="si">}</span><span class="s1">&#39;</span>
    <span class="n">extract_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;osmium extract -s smart -S tags=natural=water </span><span class="si">{</span><span class="n">bbox</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">water_file</span><span class="si">}</span><span class="s1"> -o </span><span class="si">{</span><span class="n">tile_pbf</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">export_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;osmium export --geometry-types=polygon </span><span class="si">{</span><span class="n">tile_pbf</span><span class="si">}</span><span class="s1"> -o </span><span class="si">{</span><span class="n">tile_geojson</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">extract_command</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">export_command</span><span class="p">)</span>

    <span class="c1"># Islands and Islets can be members of the water features, so they must be removed.</span>
    <span class="n">water_gdf</span> <span class="o">=</span> <span class="n">gpd</span><span class="o">.</span><span class="n">read_file</span><span class="p">(</span><span class="n">tile_geojson</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;pyogrio&#39;</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">water_gdf</span> <span class="o">=</span> <span class="n">water_gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">water_gdf</span><span class="p">[</span><span class="n">water_gdf</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;island&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="n">water_gdf</span> <span class="o">=</span> <span class="n">water_gdf</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">water_gdf</span><span class="p">[</span><span class="n">water_gdf</span><span class="p">[</span><span class="s1">&#39;place&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;islet&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
        <span class="c1"># When there are no islands to remove, an AttributeError should throw, but we don&#39;t care about it.</span>
        <span class="k">pass</span>
    <span class="n">water_gdf</span><span class="o">.</span><span class="n">to_file</span><span class="p">(</span><span class="n">tile_shp</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">engine</span><span class="o">=</span><span class="s1">&#39;pyogrio&#39;</span><span class="p">)</span>
    <span class="n">water_gdf</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">tile_width_deg</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat</span> <span class="o">+</span> <span class="n">tile_height_deg</span>
    <span class="n">pixel_size_x</span> <span class="o">=</span> <span class="mf">0.00009009009</span>
    <span class="n">pixel_size_y</span> <span class="o">=</span> <span class="mf">0.00009009009</span>

    <span class="n">gdal</span><span class="o">.</span><span class="n">Rasterize</span><span class="p">(</span>
        <span class="n">tile_tif</span><span class="p">,</span>
        <span class="n">tile_shp</span><span class="p">,</span>
        <span class="n">xRes</span><span class="o">=</span><span class="n">pixel_size_x</span><span class="p">,</span>
        <span class="n">yRes</span><span class="o">=</span><span class="n">pixel_size_y</span><span class="p">,</span>
        <span class="n">burnValues</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">outputBounds</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span>
        <span class="n">outputType</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
        <span class="n">creationOptions</span><span class="o">=</span><span class="n">GDAL_OPTIONS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">temp_files</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.dbf&#39;</span><span class="p">,</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.cpg&#39;</span><span class="p">,</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.prj&#39;</span><span class="p">,</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.shx&#39;</span><span class="p">,</span>
        <span class="n">tile_shp</span><span class="p">,</span>
        <span class="n">tile_pbf</span><span class="p">,</span>
        <span class="n">tile_geojson</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">remove_temp_files</span><span class="p">(</span><span class="n">temp_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_osm_tiles.merge_interior_and_ocean" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_interior_and_ocean</span><span class="p">(</span><span class="n">internal_tile_dir</span><span class="p">,</span> <span class="n">ocean_tile_dir</span><span class="p">,</span> <span class="n">finished_tile_dir</span><span class="p">,</span> <span class="n">translate_to_cog</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_osm_tiles.merge_interior_and_ocean" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Merge the interior water tiles and ocean water tiles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>interior_tile_dir</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the directory containing the interior water tiles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>ocean_tile_dir</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the directory containing the ocean water tiles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>merged_tile_dir</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the directory containing the merged water tiles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_osm_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_interior_and_ocean</span><span class="p">(</span><span class="n">internal_tile_dir</span><span class="p">,</span> <span class="n">ocean_tile_dir</span><span class="p">,</span> <span class="n">finished_tile_dir</span><span class="p">,</span> <span class="n">translate_to_cog</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge the interior water tiles and ocean water tiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        interior_tile_dir: The path to the directory containing the interior water tiles.</span>
<span class="sd">        ocean_tile_dir: The path to the directory containing the ocean water tiles.</span>
<span class="sd">        merged_tile_dir: The path to the directory containing the merged water tiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_tiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">([</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">internal_tile_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;tif&#39;</span><span class="p">)])</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">internal_tile_dir</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">):</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="n">internal_tile</span> <span class="o">=</span> <span class="n">internal_tile_dir</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="n">external_tile</span> <span class="o">=</span> <span class="n">ocean_tile_dir</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="n">output_tile</span> <span class="o">=</span> <span class="n">finished_tile_dir</span> <span class="o">+</span> <span class="n">filename</span>
            <span class="n">command</span> <span class="o">=</span> <span class="p">[</span>
                <span class="s1">&#39;gdal_calc.py&#39;</span><span class="p">,</span>
                <span class="s1">&#39;-A&#39;</span><span class="p">,</span>
                <span class="n">internal_tile</span><span class="p">,</span>
                <span class="s1">&#39;-B&#39;</span><span class="p">,</span>
                <span class="n">external_tile</span><span class="p">,</span>
                <span class="s1">&#39;--format&#39;</span><span class="p">,</span>
                <span class="s1">&#39;GTiff&#39;</span><span class="p">,</span>
                <span class="s1">&#39;--outfile&#39;</span><span class="p">,</span>
                <span class="n">output_tile</span><span class="p">,</span>
                <span class="s1">&#39;--calc&#39;</span><span class="p">,</span>
                <span class="s1">&#39;&quot;logical_or(A, B)&quot;&#39;</span><span class="p">,</span>
            <span class="p">]</span>
            <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">translate_to_cog</span><span class="p">:</span>
                <span class="n">cogs_dir</span> <span class="o">=</span> <span class="n">finished_tile_dir</span> <span class="o">+</span> <span class="s1">&#39;cogs/&#39;</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">cogs_dir</span><span class="p">)</span>
                <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
                    <span class="k">pass</span>
                <span class="n">out_file</span> <span class="o">=</span> <span class="n">cogs_dir</span> <span class="o">+</span> <span class="n">filename</span>
                <span class="n">translate_string</span> <span class="o">=</span> <span class="s1">&#39;gdal_translate -ot Byte -of COG -co NUM_THREADS=all_cpus&#39;</span>
                <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">translate_string</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">output_tile</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">out_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
                <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">output_tile</span><span class="p">)</span>

            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Elapsed Time: </span><span class="si">{</span><span class="n">total_time</span><span class="si">}</span><span class="s1">(s)&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Completed </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">num_tiles</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

            <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_osm_tiles.process_ocean_tiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_ocean_tiles</span><span class="p">(</span><span class="n">ocean_polygons_path</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tile_width_deg</span><span class="p">,</span> <span class="n">tile_height_deg</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_osm_tiles.process_ocean_tiles" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Process and crop OSM ocean polygons into a tif tile.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>ocean_polygons_path</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the global ocean polygons file from OSM.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum latitude of the tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum longitude of the tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_width_deg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width of the tile in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_height_deg</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The height of the tile in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_osm_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_ocean_tiles</span><span class="p">(</span><span class="n">ocean_polygons_path</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tile_width_deg</span><span class="p">,</span> <span class="n">tile_height_deg</span><span class="p">,</span> <span class="n">output_dir</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process and crop OSM ocean polygons into a tif tile.</span>

<span class="sd">    Args:</span>
<span class="sd">        ocean_polygons_path: The path to the global ocean polygons file from OSM.</span>
<span class="sd">        lat: The minimum latitude of the tile.</span>
<span class="sd">        lon: The minimum longitude of the tile.</span>
<span class="sd">        tile_width_deg: The width of the tile in degrees.</span>
<span class="sd">        tile_height_deg: The height of the tile in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">tile</span> <span class="o">=</span> <span class="n">lat_lon_to_tile_string</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">is_worldcover</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="n">tile_tif</span> <span class="o">=</span> <span class="n">output_dir</span> <span class="o">+</span> <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span>

    <span class="n">xmin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">ymax</span> <span class="o">=</span> <span class="n">lon</span><span class="p">,</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">tile_width_deg</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lat</span> <span class="o">+</span> <span class="n">tile_height_deg</span>
    <span class="n">pixel_size_x</span> <span class="o">=</span> <span class="mf">0.00009009009</span>
    <span class="n">pixel_size_y</span> <span class="o">=</span> <span class="mf">0.00009009009</span>

    <span class="n">clipped_polygons_path</span> <span class="o">=</span> <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.shp&#39;</span>
    <span class="n">command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;ogr2ogr -clipsrc </span><span class="si">{</span><span class="n">xmin</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ymin</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">xmax</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ymax</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">clipped_polygons_path</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">ocean_polygons_path</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

    <span class="n">gdal</span><span class="o">.</span><span class="n">Rasterize</span><span class="p">(</span>
        <span class="n">tile_tif</span><span class="p">,</span>
        <span class="n">clipped_polygons_path</span><span class="p">,</span>
        <span class="n">xRes</span><span class="o">=</span><span class="n">pixel_size_x</span><span class="p">,</span>
        <span class="n">yRes</span><span class="o">=</span><span class="n">pixel_size_y</span><span class="p">,</span>
        <span class="n">burnValues</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">outputBounds</span><span class="o">=</span><span class="p">[</span><span class="n">xmin</span><span class="p">,</span> <span class="n">ymin</span><span class="p">,</span> <span class="n">xmax</span><span class="p">,</span> <span class="n">ymax</span><span class="p">],</span>
        <span class="n">outputType</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
        <span class="n">creationOptions</span><span class="o">=</span><span class="n">GDAL_OPTIONS</span><span class="p">,</span>
    <span class="p">)</span>

    <span class="n">temp_files</span> <span class="o">=</span> <span class="p">[</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.dbf&#39;</span><span class="p">,</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.cpg&#39;</span><span class="p">,</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.prj&#39;</span><span class="p">,</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.shx&#39;</span><span class="p">,</span>
        <span class="n">tile</span> <span class="o">+</span> <span class="s1">&#39;.shp&#39;</span><span class="p">,</span>
    <span class="p">]</span>
    <span class="n">remove_temp_files</span><span class="p">(</span><span class="n">temp_files</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_osm_tiles.process_pbf" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">process_pbf</span><span class="p">(</span><span class="n">planet_file</span><span class="p">,</span> <span class="n">output_file</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_osm_tiles.process_pbf" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Process the global PBF file so that it only contains water features.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>planet_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The path to the OSM Planet PBF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>output_file</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The desired path of the processed PBF file.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_osm_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">process_pbf</span><span class="p">(</span><span class="n">planet_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">output_file</span><span class="p">:</span> <span class="nb">str</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Process the global PBF file so that it only contains water features.</span>

<span class="sd">    Args:</span>
<span class="sd">        planet_file: The path to the OSM Planet PBF file.</span>
<span class="sd">        output_file: The desired path of the processed PBF file.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">natural_file</span> <span class="o">=</span> <span class="s1">&#39;planet_natural.pbf&#39;</span>
    <span class="n">waterways_file</span> <span class="o">=</span> <span class="s1">&#39;planet_waterways.pbf&#39;</span>
    <span class="n">reservoirs_file</span> <span class="o">=</span> <span class="s1">&#39;planet_reservoirs.pbf&#39;</span>

    <span class="n">natural_water_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;osmium tags-filter -o </span><span class="si">{</span><span class="n">natural_file</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">planet_file</span><span class="si">}</span><span class="s1"> wr/natural=water&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">waterways_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;osmium tags-filter -o </span><span class="si">{</span><span class="n">waterways_file</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">planet_file</span><span class="si">}</span><span class="s1"> waterway=&quot;*&quot;&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">reservoirs_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;osmium tags-filter -o </span><span class="si">{</span><span class="n">reservoirs_file</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">planet_file</span><span class="si">}</span><span class="s1"> landuse=reservoir&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>
    <span class="n">merge_command</span> <span class="o">=</span> <span class="sa">f</span><span class="s1">&#39;osmium merge </span><span class="si">{</span><span class="n">natural_file</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">waterways_file</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">reservoirs_file</span><span class="si">}</span><span class="s1"> -o </span><span class="si">{</span><span class="n">output_file</span><span class="si">}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">)</span>

    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">natural_water_command</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">waterways_command</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">reservoirs_command</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">merge_command</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="asf_tools.watermasking.generate_worldcover_tiles" class="doc doc-heading">
            <code>generate_worldcover_tiles</code>


<a href="#asf_tools.watermasking.generate_worldcover_tiles" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_worldcover_tiles.build_dataset" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">build_dataset</span><span class="p">(</span><span class="n">worldcover_tile_dir</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">tile_height</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_worldcover_tiles.build_dataset" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Main function for generating a dataset with worldcover tiles.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>worldcover_tile_dir</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory containing the unprocessed worldcover tiles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The range of latitudes the dataset should cover.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The range of longitudes the dataset should cover.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_degrees</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width of the outputed dataset tiles in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_worldcover_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">build_dataset</span><span class="p">(</span><span class="n">worldcover_tile_dir</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">tile_height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Main function for generating a dataset with worldcover tiles.</span>

<span class="sd">    Args:</span>
<span class="sd">        worldcover_tile_dir: The directory containing the unprocessed worldcover tiles.</span>
<span class="sd">        lat_range: The range of latitudes the dataset should cover.</span>
<span class="sd">        lon_range: The range of longitudes the dataset should cover.</span>
<span class="sd">        out_degrees: The width of the outputed dataset tiles in degrees.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lat_range</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lon_range</span><span class="p">:</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="n">lat_lon_to_tile_string</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">is_worldcover</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
            <span class="n">tile_filename</span> <span class="o">=</span> <span class="n">UNCROPPED_TILE_DIR</span> <span class="o">+</span> <span class="n">tile</span>
            <span class="n">worldcover_tiles</span> <span class="o">=</span> <span class="n">lat_lon_to_filenames</span><span class="p">(</span><span class="n">worldcover_tile_dir</span><span class="p">,</span> <span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">),</span> <span class="n">WORLDCOVER_TILE_SIZE</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing: </span><span class="si">{</span><span class="n">tile_filename</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="n">worldcover_tiles</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="n">merge_tiles</span><span class="p">(</span><span class="n">worldcover_tiles</span><span class="p">,</span> <span class="n">tile_filename</span><span class="p">,</span> <span class="s1">&#39;GTiff&#39;</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="n">crop_tile</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">tile_height</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Time Elapsed: </span><span class="si">{</span><span class="n">total_time</span><span class="si">}</span><span class="s1">s&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_worldcover_tiles.create_missing_tiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">create_missing_tiles</span><span class="p">(</span><span class="n">tile_dir</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_worldcover_tiles.create_missing_tiles" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Check for, and build, tiles that may be missing from WorldCover, such as over the ocean.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat_range</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The range of latitudes to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon_range</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The range of longitudes to check.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>current_existing_tiles</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of tiles that exist after the function has completed.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_worldcover_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">create_missing_tiles</span><span class="p">(</span><span class="n">tile_dir</span><span class="p">,</span> <span class="n">lat_range</span><span class="p">,</span> <span class="n">lon_range</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Check for, and build, tiles that may be missing from WorldCover, such as over the ocean.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat_range: The range of latitudes to check.</span>
<span class="sd">        lon_range: The range of longitudes to check.</span>

<span class="sd">    Returns:</span>
<span class="sd">        current_existing_tiles: The list of tiles that exist after the function has completed.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">current_existing_tiles</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tile_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="n">FILENAME_POSTFIX</span><span class="p">)]</span>
    <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lon_range</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lat_range</span><span class="p">:</span>
            <span class="n">tile</span> <span class="o">=</span> <span class="n">lat_lon_to_tile_string</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">is_worldcover</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Checking </span><span class="si">{</span><span class="n">tile</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">tile</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">current_existing_tiles</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Could not find </span><span class="si">{</span><span class="n">tile</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

                <span class="n">filename</span> <span class="o">=</span> <span class="n">PREPROCESSED_TILE_DIR</span> <span class="o">+</span> <span class="n">tile</span>
                <span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span> <span class="o">=</span> <span class="mi">36000</span><span class="p">,</span> <span class="mi">36000</span>
                <span class="n">x_res</span><span class="p">,</span> <span class="n">y_res</span> <span class="o">=</span> <span class="mf">8.333333333333333055e-05</span><span class="p">,</span> <span class="o">-</span><span class="mf">8.333333333333333055e-05</span>
                <span class="n">ul_lon</span> <span class="o">=</span> <span class="n">lon</span>
                <span class="n">ul_lat</span> <span class="o">=</span> <span class="n">lat</span> <span class="o">+</span> <span class="n">WORLDCOVER_TILE_SIZE</span>
                <span class="n">geotransform</span> <span class="o">=</span> <span class="p">(</span><span class="n">ul_lon</span><span class="p">,</span> <span class="n">x_res</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">ul_lat</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y_res</span><span class="p">)</span>

                <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>
                <span class="n">ds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span>
                    <span class="n">filename</span><span class="p">,</span>
                    <span class="n">xsize</span><span class="o">=</span><span class="n">x_size</span><span class="p">,</span>
                    <span class="n">ysize</span><span class="o">=</span><span class="n">y_size</span><span class="p">,</span>
                    <span class="n">bands</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                    <span class="n">eType</span><span class="o">=</span><span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
                    <span class="n">options</span><span class="o">=</span><span class="n">GDAL_OPTIONS</span><span class="p">,</span>
                <span class="p">)</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">)</span>
                <span class="n">ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">geotransform</span><span class="p">)</span>
                <span class="n">band</span> <span class="o">=</span> <span class="n">ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Write ones, as tiles should only be missing over water.</span>
                <span class="n">band</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="n">x_size</span><span class="p">,</span> <span class="n">y_size</span><span class="p">)))</span>

                <span class="k">del</span> <span class="n">ds</span>
                <span class="k">del</span> <span class="n">band</span>

                <span class="n">current_existing_tiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tile</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Added </span><span class="si">{</span><span class="n">tile</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">current_existing_tiles</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_worldcover_tiles.crop_tile" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">crop_tile</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">tile_height</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_worldcover_tiles.crop_tile" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Crop the merged tiles</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tile</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The filename of the desired tile to crop.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_worldcover_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">crop_tile</span><span class="p">(</span><span class="n">tile</span><span class="p">,</span> <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">tile_height</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Crop the merged tiles</span>

<span class="sd">    Args:</span>
<span class="sd">        tile: The filename of the desired tile to crop.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">in_filename</span> <span class="o">=</span> <span class="n">UNCROPPED_TILE_DIR</span> <span class="o">+</span> <span class="n">tile</span>
    <span class="n">out_filename</span> <span class="o">=</span> <span class="n">CROPPED_TILE_DIR</span> <span class="o">+</span> <span class="n">tile</span>
    <span class="n">pixel_size_x</span><span class="p">,</span> <span class="n">pixel_size_y</span> <span class="o">=</span> <span class="mf">0.00009009009</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.00009009009</span>

    <span class="n">src_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">in_filename</span><span class="p">)</span>
    <span class="n">gdal</span><span class="o">.</span><span class="n">Translate</span><span class="p">(</span>
        <span class="n">out_filename</span><span class="p">,</span>
        <span class="n">src_ds</span><span class="p">,</span>
        <span class="n">projWin</span><span class="o">=</span><span class="p">[</span><span class="n">lon</span><span class="p">,</span> <span class="n">lat</span> <span class="o">+</span> <span class="n">tile_height</span><span class="p">,</span> <span class="n">lon</span> <span class="o">+</span> <span class="n">tile_width</span><span class="p">,</span> <span class="n">lat</span><span class="p">],</span>
        <span class="n">xRes</span><span class="o">=</span><span class="n">pixel_size_x</span><span class="p">,</span>
        <span class="n">yRes</span><span class="o">=</span><span class="n">pixel_size_y</span><span class="p">,</span>
        <span class="n">outputSRS</span><span class="o">=</span><span class="s1">&#39;EPSG:4326&#39;</span><span class="p">,</span>
        <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;COG&#39;</span><span class="p">,</span>
        <span class="n">creationOptions</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;NUM_THREADS=all_cpus&#39;</span><span class="p">],</span>
    <span class="p">)</span>
    <span class="n">remove_temp_files</span><span class="p">([</span><span class="s1">&#39;tmp_px_size.tif&#39;</span><span class="p">,</span> <span class="s1">&#39;tmp.shp&#39;</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_worldcover_tiles.get_tiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">get_tiles</span><span class="p">(</span><span class="n">osm_tile_coord</span><span class="p">,</span> <span class="n">wc_tile_width</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_worldcover_tiles.get_tiles" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a list of the worldcover tile locations necessary to fully cover an OSM tile.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>osm_tile_coord</code>
            </td>
            <td>
                  <code><span title="tuple">tuple</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lower left corner coordinate (lat, lon) of the desired OSM tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wc_tile_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width/height of the Worldcover tiles in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width/height of the OSM tiles in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>tiles</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A list of the lower left corner coordinates of the Worldcover tiles that overlap the OSM tile.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_worldcover_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">get_tiles</span><span class="p">(</span><span class="n">osm_tile_coord</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">wc_tile_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of the worldcover tile locations necessary to fully cover an OSM tile.</span>

<span class="sd">    Args:</span>
<span class="sd">        osm_tile_coord: The lower left corner coordinate (lat, lon) of the desired OSM tile.</span>
<span class="sd">        wc_tile_width: The width/height of the Worldcover tiles in degrees.</span>
<span class="sd">        tile_width: The width/height of the OSM tiles in degrees.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tiles: A list of the lower left corner coordinates of the Worldcover tiles that overlap the OSM tile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">osm_lat</span> <span class="o">=</span> <span class="n">osm_tile_coord</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">osm_lon</span> <span class="o">=</span> <span class="n">osm_tile_coord</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

    <span class="n">min_lat</span> <span class="o">=</span> <span class="n">osm_lat</span> <span class="o">-</span> <span class="p">(</span><span class="n">osm_lat</span> <span class="o">%</span> <span class="n">wc_tile_width</span><span class="p">)</span>
    <span class="n">max_lat</span> <span class="o">=</span> <span class="n">osm_lat</span> <span class="o">+</span> <span class="n">tile_width</span>
    <span class="n">min_lon</span> <span class="o">=</span> <span class="n">osm_lon</span> <span class="o">-</span> <span class="p">(</span><span class="n">osm_lon</span> <span class="o">%</span> <span class="n">wc_tile_width</span><span class="p">)</span>
    <span class="n">max_lon</span> <span class="o">=</span> <span class="n">osm_lon</span> <span class="o">+</span> <span class="n">tile_width</span>

    <span class="n">lats</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">wc_tile_width</span><span class="p">)</span>
    <span class="n">lons</span> <span class="o">=</span> <span class="nb">range</span><span class="p">(</span><span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">,</span> <span class="n">wc_tile_width</span><span class="p">)</span>

    <span class="n">tiles</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">lat</span> <span class="ow">in</span> <span class="n">lats</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">lon</span> <span class="ow">in</span> <span class="n">lons</span><span class="p">:</span>
            <span class="n">tiles</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">tiles</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_worldcover_tiles.lat_lon_to_filenames" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lat_lon_to_filenames</span><span class="p">(</span><span class="n">worldcover_tile_dir</span><span class="p">,</span> <span class="n">osm_tile_coord</span><span class="p">,</span> <span class="n">wc_tile_width</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_worldcover_tiles.lat_lon_to_filenames" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get a list of the Worldcover tile filenames that are necessary to overlap an OSM tile.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>osm_tile</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The lower left corner (lat, lon) of the desired OSM tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>wc_tile_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width of the Worldcover tiles in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>tile_width</code>
            </td>
            <td>
                  <code><span title="int">int</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The width of the OSM tiles in degrees.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
<th>Name</th>          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
<td><code>filenames</code></td>            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of Worldcover filenames.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_worldcover_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">lat_lon_to_filenames</span><span class="p">(</span><span class="n">worldcover_tile_dir</span><span class="p">,</span> <span class="n">osm_tile_coord</span><span class="p">:</span> <span class="nb">tuple</span><span class="p">,</span> <span class="n">wc_tile_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">:</span> <span class="nb">int</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get a list of the Worldcover tile filenames that are necessary to overlap an OSM tile.</span>

<span class="sd">    Args:</span>
<span class="sd">        osm_tile: The lower left corner (lat, lon) of the desired OSM tile.</span>
<span class="sd">        wc_tile_width: The width of the Worldcover tiles in degrees.</span>
<span class="sd">        tile_width: The width of the OSM tiles in degrees.</span>

<span class="sd">    Returns:</span>
<span class="sd">        filenames: The list of Worldcover filenames.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">tiles</span> <span class="o">=</span> <span class="n">get_tiles</span><span class="p">(</span><span class="n">osm_tile_coord</span><span class="p">,</span> <span class="n">wc_tile_width</span><span class="p">,</span> <span class="n">tile_width</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">tile</span> <span class="ow">in</span> <span class="n">tiles</span><span class="p">:</span>
        <span class="n">filenames</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">worldcover_tile_dir</span> <span class="o">+</span> <span class="n">lat_lon_to_tile_string</span><span class="p">(</span><span class="n">tile</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">tile</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">is_worldcover</span><span class="o">=</span><span class="kc">True</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">filenames</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.generate_worldcover_tiles.tile_preprocessing" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">tile_preprocessing</span><span class="p">(</span><span class="n">tile_dir</span><span class="p">,</span> <span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.generate_worldcover_tiles.tile_preprocessing" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>The worldcover tiles have lots of unnecessary classes, these need to be removed first.
   Note: make a back-up copy of this directory.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tile_dir</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The directory containing all of the worldcover tiles.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/generate_worldcover_tiles.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">tile_preprocessing</span><span class="p">(</span><span class="n">tile_dir</span><span class="p">,</span> <span class="n">min_lat</span><span class="p">,</span> <span class="n">max_lat</span><span class="p">,</span> <span class="n">min_lon</span><span class="p">,</span> <span class="n">max_lon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;The worldcover tiles have lots of unnecessary classes, these need to be removed first.</span>
<span class="sd">       Note: make a back-up copy of this directory.</span>

<span class="sd">    Args:</span>
<span class="sd">        tile_dir: The directory containing all of the worldcover tiles.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">filenames</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">tile_dir</span><span class="p">)</span> <span class="k">if</span> <span class="n">f</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s1">&#39;.tif&#39;</span><span class="p">)]</span>

    <span class="k">def</span><span class="w"> </span><span class="nf">filename_filter</span><span class="p">(</span><span class="n">filename</span><span class="p">):</span>
        <span class="n">latitude</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">longitude</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">][</span><span class="mi">4</span><span class="p">:</span><span class="mi">7</span><span class="p">])</span>
        <span class="k">if</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">][</span><span class="mi">3</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;W&#39;</span><span class="p">:</span>
            <span class="n">longitude</span> <span class="o">=</span> <span class="o">-</span><span class="n">longitude</span>
        <span class="n">mnlat</span> <span class="o">=</span> <span class="n">min_lat</span> <span class="o">-</span> <span class="p">(</span><span class="n">min_lat</span> <span class="o">%</span> <span class="n">WORLDCOVER_TILE_SIZE</span><span class="p">)</span>
        <span class="n">mnlon</span> <span class="o">=</span> <span class="n">min_lon</span> <span class="o">-</span> <span class="p">(</span><span class="n">min_lon</span> <span class="o">%</span> <span class="n">WORLDCOVER_TILE_SIZE</span><span class="p">)</span>
        <span class="n">mxlat</span> <span class="o">=</span> <span class="n">max_lat</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_lat</span> <span class="o">%</span> <span class="n">WORLDCOVER_TILE_SIZE</span><span class="p">)</span>
        <span class="n">mxlon</span> <span class="o">=</span> <span class="n">max_lon</span> <span class="o">+</span> <span class="p">(</span><span class="n">max_lon</span> <span class="o">%</span> <span class="n">WORLDCOVER_TILE_SIZE</span><span class="p">)</span>
        <span class="n">in_lat_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">latitude</span> <span class="o">&gt;=</span> <span class="n">mnlat</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">latitude</span> <span class="o">&lt;=</span> <span class="n">mxlat</span><span class="p">)</span>
        <span class="n">in_lon_range</span> <span class="o">=</span> <span class="p">(</span><span class="n">longitude</span> <span class="o">&gt;=</span> <span class="n">mnlon</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">longitude</span> <span class="o">&lt;=</span> <span class="n">mxlon</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">in_lat_range</span> <span class="ow">and</span> <span class="n">in_lon_range</span>

    <span class="n">filenames_filtered</span> <span class="o">=</span> <span class="p">[</span><span class="n">f</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">filenames</span> <span class="k">if</span> <span class="n">filename_filter</span><span class="p">(</span><span class="n">f</span><span class="p">)]</span>

    <span class="n">index</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">num_tiles</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filenames_filtered</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">filename</span> <span class="ow">in</span> <span class="n">filenames_filtered</span><span class="p">:</span>
        <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="n">tile_name</span> <span class="o">=</span> <span class="n">filename</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s1">&#39;_&#39;</span><span class="p">)[</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">filename</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">Path</span><span class="p">(</span><span class="n">tile_dir</span><span class="p">)</span> <span class="o">/</span> <span class="n">filename</span><span class="p">)</span>
        <span class="n">dst_filename</span> <span class="o">=</span> <span class="n">PREPROCESSED_TILE_DIR</span> <span class="o">+</span> <span class="n">tile_name</span> <span class="o">+</span> <span class="s1">&#39;.tif&#39;</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing: </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s1">  ---  </span><span class="si">{</span><span class="n">dst_filename</span><span class="si">}</span><span class="s1">  -- </span><span class="si">{</span><span class="n">index</span><span class="si">}</span><span class="s1"> of </span><span class="si">{</span><span class="n">num_tiles</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>

        <span class="n">src_ds</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">Open</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>
        <span class="n">src_band</span> <span class="o">=</span> <span class="n">src_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">src_arr</span> <span class="o">=</span> <span class="n">src_band</span><span class="o">.</span><span class="n">ReadAsArray</span><span class="p">()</span>

        <span class="n">not_water</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">src_arr</span> <span class="o">!=</span> <span class="mi">80</span><span class="p">,</span> <span class="n">src_arr</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span>
        <span class="n">water_arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones</span><span class="p">(</span><span class="n">src_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>
        <span class="n">water_arr</span><span class="p">[</span><span class="n">not_water</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="n">driver</span> <span class="o">=</span> <span class="n">gdal</span><span class="o">.</span><span class="n">GetDriverByName</span><span class="p">(</span><span class="s1">&#39;GTiff&#39;</span><span class="p">)</span>
        <span class="n">dst_ds</span> <span class="o">=</span> <span class="n">driver</span><span class="o">.</span><span class="n">Create</span><span class="p">(</span>
            <span class="n">dst_filename</span><span class="p">,</span>
            <span class="n">water_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
            <span class="n">water_arr</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span>
            <span class="mi">1</span><span class="p">,</span>
            <span class="n">gdal</span><span class="o">.</span><span class="n">GDT_Byte</span><span class="p">,</span>
            <span class="n">options</span><span class="o">=</span><span class="n">GDAL_OPTIONS</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetGeoTransform</span><span class="p">(</span><span class="n">src_ds</span><span class="o">.</span><span class="n">GetGeoTransform</span><span class="p">())</span>
        <span class="n">dst_ds</span><span class="o">.</span><span class="n">SetProjection</span><span class="p">(</span><span class="n">src_ds</span><span class="o">.</span><span class="n">GetProjection</span><span class="p">())</span>
        <span class="n">dst_band</span> <span class="o">=</span> <span class="n">dst_ds</span><span class="o">.</span><span class="n">GetRasterBand</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">dst_band</span><span class="o">.</span><span class="n">WriteArray</span><span class="p">(</span><span class="n">water_arr</span><span class="p">)</span>
        <span class="n">dst_band</span><span class="o">.</span><span class="n">FlushCache</span><span class="p">()</span>

        <span class="k">del</span> <span class="n">dst_ds</span>
        <span class="k">del</span> <span class="n">src_ds</span>

        <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="n">total_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Processing </span><span class="si">{</span><span class="n">dst_filename</span><span class="si">}</span><span class="s1"> took </span><span class="si">{</span><span class="n">total_time</span><span class="si">}</span><span class="s1"> seconds.&#39;</span><span class="p">)</span>

        <span class="n">index</span> <span class="o">+=</span> <span class="mi">1</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>

<div class="doc doc-object doc-module">



<h3 id="asf_tools.watermasking.utils" class="doc doc-heading">
            <code>utils</code>


<a href="#asf_tools.watermasking.utils" class="headerlink" title="Permanent link">&para;</a></h3>

    <div class="doc doc-contents ">









  <div class="doc doc-children">









<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.utils.lat_lon_to_tile_string" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">lat_lon_to_tile_string</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">is_worldcover</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">postfix</span><span class="o">=</span><span class="s1">&#39;.tif&#39;</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.utils.lat_lon_to_tile_string" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Get the name of the tile with lower left corner (lat, lon).</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>lat</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum latitude of the tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>lon</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The minimum longitude of the tile.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>is_worldcover</code>
            </td>
            <td>
                  <code><span title="bool">bool</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>Wheter the tile is Worldcover or OSM.</p>
              </div>
            </td>
            <td>
                  <code>False</code>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>postfix</code>
            </td>
            <td>
                  <code><span title="str">str</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>A postfix to append to the tile name to make it a filename.</p>
              </div>
            </td>
            <td>
                  <code>&#39;.tif&#39;</code>
            </td>
          </tr>
      </tbody>
    </table>


    <p><span class="doc-section-title">Returns:</span></p>
    <table>
      <thead>
        <tr>
          <th>Type</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the tile.</p>
              </div>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 7</span>
<span class="normal"> 8</span>
<span class="normal"> 9</span>
<span class="normal">10</span>
<span class="normal">11</span>
<span class="normal">12</span>
<span class="normal">13</span>
<span class="normal">14</span>
<span class="normal">15</span>
<span class="normal">16</span>
<span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">lat_lon_to_tile_string</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">is_worldcover</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">postfix</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;.tif&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Get the name of the tile with lower left corner (lat, lon).</span>

<span class="sd">    Args:</span>
<span class="sd">        lat: The minimum latitude of the tile.</span>
<span class="sd">        lon: The minimum longitude of the tile.</span>
<span class="sd">        is_worldcover: Wheter the tile is Worldcover or OSM.</span>
<span class="sd">        postfix: A postfix to append to the tile name to make it a filename.</span>

<span class="sd">    Returns:</span>
<span class="sd">        The name of the tile.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">prefixes</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;N&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">,</span> <span class="s1">&#39;W&#39;</span><span class="p">]</span> <span class="k">if</span> <span class="n">is_worldcover</span> <span class="k">else</span> <span class="p">[</span><span class="s1">&#39;n&#39;</span><span class="p">,</span> <span class="s1">&#39;s&#39;</span><span class="p">,</span> <span class="s1">&#39;e&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">lat</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lat_part</span> <span class="o">=</span> <span class="n">prefixes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lat</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lat_part</span> <span class="o">=</span> <span class="n">prefixes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lat</span><span class="p">)))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">lon</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">lon_part</span> <span class="o">=</span> <span class="n">prefixes</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">lon</span><span class="p">))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lon_part</span> <span class="o">=</span> <span class="n">prefixes</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">lon</span><span class="p">)))</span><span class="o">.</span><span class="n">zfill</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">lat_part</span> <span class="o">+</span> <span class="n">lon_part</span> <span class="o">+</span> <span class="n">postfix</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.utils.merge_tiles" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">merge_tiles</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span> <span class="n">out_format</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.utils.merge_tiles" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Merge tiles via buildvrt and translate.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>tiles</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of tiles to be merged.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_format</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The format of the output image.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
          <tr class="doc-section-item">
            <td>
                <code>out_filename</code>
            </td>
            <td>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The name of the output COG.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">merge_tiles</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">,</span> <span class="n">out_format</span><span class="p">,</span> <span class="n">compress</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Merge tiles via buildvrt and translate.</span>

<span class="sd">    Args:</span>
<span class="sd">        tiles: The list of tiles to be merged.</span>
<span class="sd">        out_format: The format of the output image.</span>
<span class="sd">        out_filename: The name of the output COG.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">vrt</span> <span class="o">=</span> <span class="s1">&#39;merged.vrt&#39;</span>
    <span class="n">build_vrt_command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gdalbuildvrt&#39;</span><span class="p">,</span> <span class="n">vrt</span><span class="p">]</span> <span class="o">+</span> <span class="n">tiles</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">compress</span><span class="p">:</span>
        <span class="n">translate_command</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;gdal_translate&#39;</span><span class="p">,</span> <span class="s1">&#39;-of&#39;</span><span class="p">,</span> <span class="n">out_format</span><span class="p">,</span> <span class="n">vrt</span><span class="p">,</span> <span class="n">out_filename</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">translate_command</span> <span class="o">=</span> <span class="p">[</span>
            <span class="s1">&#39;gdal_translate&#39;</span><span class="p">,</span>
            <span class="s1">&#39;-of&#39;</span><span class="p">,</span>
            <span class="n">out_format</span><span class="p">,</span>
            <span class="s1">&#39;-co&#39;</span><span class="p">,</span>
            <span class="s1">&#39;COMPRESS=LZW&#39;</span><span class="p">,</span>
            <span class="s1">&#39;-co&#39;</span><span class="p">,</span>
            <span class="s1">&#39;NUM_THREADS=all_cpus&#39;</span><span class="p">,</span>
            <span class="n">vrt</span><span class="p">,</span>
            <span class="n">out_filename</span><span class="p">,</span>
        <span class="p">]</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">build_vrt_command</span><span class="p">)</span>
    <span class="n">subprocess</span><span class="o">.</span><span class="n">run</span><span class="p">(</span><span class="n">translate_command</span><span class="p">)</span>
    <span class="n">remove_temp_files</span><span class="p">([</span><span class="n">vrt</span><span class="p">])</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.utils.remove_temp_files" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">remove_temp_files</span><span class="p">(</span><span class="n">temp_files</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.utils.remove_temp_files" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Remove each file in a list of files.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <table>
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Description</th>
          <th>Default</th>
        </tr>
      </thead>
      <tbody>
          <tr class="doc-section-item">
            <td>
                <code>temp_files</code>
            </td>
            <td>
                  <code><span title="list">list</span></code>
            </td>
            <td>
              <div class="doc-md-description">
                <p>The list of temporary files to remove.</p>
              </div>
            </td>
            <td>
                <em>required</em>
            </td>
          </tr>
      </tbody>
    </table>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">remove_temp_files</span><span class="p">(</span><span class="n">temp_files</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Remove each file in a list of files.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp_files: The list of temporary files to remove.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">file</span> <span class="ow">in</span> <span class="n">temp_files</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Temp file </span><span class="si">{</span><span class="n">file</span><span class="si">}</span><span class="s1"> was not found, skipping removal...&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="asf_tools.watermasking.utils.setup_directories" class="doc doc-heading">
            <code class="highlight language-python"><span class="n">setup_directories</span><span class="p">(</span><span class="n">dirs</span><span class="p">)</span></code>

<a href="#asf_tools.watermasking.utils.setup_directories" class="headerlink" title="Permanent link">&para;</a></h4>


    <div class="doc doc-contents ">

        <p>Setup the directories necessary for running the script.</p>


            <details class="quote">
              <summary>Source code in <code>asf_tools/watermasking/utils.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">setup_directories</span><span class="p">(</span><span class="n">dirs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="nb">str</span><span class="p">]):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Setup the directories necessary for running the script.&quot;&quot;&quot;</span>
    <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">dirs</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">directory</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileExistsError</span><span class="p">:</span>
            <span class="c1"># Directories already exists.</span>
            <span class="k">pass</span>
</code></pre></div></td></tr></table></div>
            </details>
    </div>

</div>



  </div>

    </div>

</div>


  </div>

    </div>

</div>


  </div>

    </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Adapted from https://github.com/squidfunk/mkdocs-material/blob/9.4.2/src/templates/partials/footer.html -->

<!-- Footer -->
<footer class="md-footer">

  <!-- Link to previous and/or next page -->
  
    
      
      <nav
        class="md-footer__inner md-grid"
        aria-label="Footer"
        
      >

        <!-- Link to previous page -->
        
          
          <a
            href="../asf_tools/"
            class="md-footer__link md-footer__link--prev"
            aria-label="Previous: ASF Tools for Python"
          >
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
            </div>
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Previous
              </span>
              <div class="md-ellipsis">
                ASF Tools for Python
              </div>
            </div>
          </a>
        

        <!-- Link to next page -->
        
          
          <a
            href="../../how_it_works/"
            class="md-footer__link md-footer__link--next"
            aria-label="Next: Architecture"
          >
            <div class="md-footer__title">
              <span class="md-footer__direction">
                Next
              </span>
              <div class="md-ellipsis">
                Architecture
              </div>
            </div>
            <div class="md-footer__button md-icon">
              
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
            </div>
          </a>
        
      </nav>
    
      <!-- ASF Footer information-->
      <div class="md-grid">
        <div class="md-footer-container md-grid">
          <div class="md-footer-container-item">
            <img src="../../images/asf-logo-blue-nav.png"
                 alt="ASF Logo"
                 class="md-footer-logo">
          </div>
          <div class="md-footer-container-item md-about-us">
            <h1>About Us</h1>
            <p>
              The Alaska Satellite Facility downlinks, processes, archives, and
              distributes remote-sensing data to scientific users around the world.
              ASFs mission is to make remote-sensing data accessible.
            </p>
            <p>
              <a href="https://asf.alaska.edu/about-asf/" target="_blank">
                Read More
              </a>
            </p>
          </div>
          <div class="md-footer-container-item md-contact-info">
            <h1>Contact Info</h1>
            <p>
              Alaska Satellite Facility<br>
              2156 Koyukuk Drive<br>
              Fairbanks, AK 99775<br>
              (907) 474-5041<br>
              uso@asf.alaska.edu<br>
            </p>
            <p>
              <a href="javascript:feedback.showForm();">Send Us A Message</a>
            </p>
          </div>
        </div>
      </div>
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <!--
  Copyright (c) 2016-2023 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Adapted from https://github.com/squidfunk/mkdocs-material/blob/9.4.2/src/templates/partials/copyright.html -->

<!-- Copyright and theme information -->
<div class="md-copyright">
  <div class="md-copyright__highlight">
    
      &copy; <span id="copyright-year"></span>
      <script type="text/javascript">
          current_year = new Date().getFullYear();
          document.getElementById("copyright-year").innerHTML=current_year;
      </script>
      Alaska Satellite Facility
    
    <!-- ASF non-discrimination disclaimer-->
    &nbsp;&nbsp;
    <a href="https://www.alaska.edu/nondiscrimination"
       target="_blank"
       class="md-copyright-link">
      UA is an AA/EO employer and educational institution and prohibits
      illegal discrimination against any individual
    </a>
  </div>
</div>

      <!-- Social links -->
      
        <div class="md-social">
  
    
    
    
    
      
      
    
    <a href="https://www.facebook.com/AKSatellite" target="_blank" rel="noopener" title="www.facebook.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 320 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="m279.14 288 14.22-92.66h-88.91v-60.13c0-25.35 12.42-50.06 52.24-50.06h40.42V6.26S260.43 0 225.36 0c-73.22 0-121.08 44.38-121.08 124.72v70.62H22.89V288h81.39v224h100.17V288z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://twitter.com/Ak_Satellite" target="_blank" rel="noopener" title="twitter.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://www.youtube.com/channel/UChCfI0oVWw4qDwEidnDskJQ" target="_blank" rel="noopener" title="www.youtube.com" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M549.655 124.083c-6.281-23.65-24.787-42.276-48.284-48.597C458.781 64 288 64 288 64S117.22 64 74.629 75.486c-23.497 6.322-42.003 24.947-48.284 48.597-11.412 42.867-11.412 132.305-11.412 132.305s0 89.438 11.412 132.305c6.281 23.65 24.787 41.5 48.284 47.821C117.22 448 288 448 288 448s170.78 0 213.371-11.486c23.497-6.321 42.003-24.171 48.284-47.821 11.412-42.867 11.412-132.305 11.412-132.305s0-89.438-11.412-132.305zm-317.51 213.508V175.185l142.739 81.205-142.739 81.201z"/></svg>
    </a>
  
    
    
    
    
      
      
    
    <a href="https://gitter.im/ASFHyP3/community" target="_blank" rel="noopener" title="gitter.im" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 6.4.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M66.4 322.5H16V0h50.4v322.5zM166.9 76.1h-50.4V512h50.4V76.1zm100.6 0h-50.4V512h50.4V76.1zM368 76h-50.4v247H368V76z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.footer", "announce.dismiss"], "search": "../../assets/javascripts/workers/search.a264c092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
    
      <script src="../../assets/javascripts/bundle.726fbb30.min.js"></script>
      
        <script src="../../javascripts/mathjax.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
    <script src="../../javascripts/expert-rec-search.js"></script>

  </body>
</html>